<!DOCTYPE html>
<html class="writer-html4" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ligo.lw.lsctables &mdash; PyCBC 2.0.dev0 documentation</title><link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/plot_directive.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/graphviz.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/terminal.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/theme_overrides.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  <script id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../../_static/doctools.js"></script>
        <script type="text/javascript" src="../../../_static/language_data.js"></script>
        <script type="text/javascript" src="../../../_static/typed.min.js"></script>
        <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../../index.html" class="icon icon-home"> PyCBC
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../credit.html">Use of PyCBC in Scientific Publications</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../docker.html">Running PyCBC under Docker</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../install.html">Installing PyCBC</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../install_virtualenv.html">Setting up virtualenv</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../install_lalsuite.html">Installing lalsuite for PyCBC</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../inference.html">PyCBC inference documentation (<code class="docutils literal notranslate"><span class="pre">pycbc.inference</span></code>)</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../workflow/pycbc_make_psd_estimation_workflow.html"><code class="docutils literal notranslate"><span class="pre">pycbc_make_psd_estimation_workflow</span></code>: A workflow generator for noise estimation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../workflow/pycbc_make_coinc_search_workflow.html"><code class="docutils literal notranslate"><span class="pre">pycbc_make_coinc_search_workflow</span></code>: A workflow to search for gravitational waves</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../workflow/pygrb.html"><code class="docutils literal notranslate"><span class="pre">pycbc_make_offline_grb_workflow</span></code>: A GRB triggered CBC analysis workflow generator</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../tmpltbank.html">PyCBC template bank generation documentation (<code class="docutils literal notranslate"><span class="pre">pycbc.tmpltbank</span></code>)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../hwinj.html">Hardware injection waveform generation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../banksim.html">Calculating the Effectualness (Fitting Factor) of Template Banks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../faithsim.html">Dag Generator for Doing Faithfulness Comparisons</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../upload_to_gracedb.html">Uploading triggers to gracedb</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../waveform_plugin.html">Making new waveform approximants available to PyCBC</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../catalog.html">Catalog of Observed Gravitational-wave Mergers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../dataquality.html">Query times of valid data, hardware injections, and more.</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../frame.html">Reading Gravitational-wave Frames</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../fft.html">Performing FFTs in PyCBC</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../gw150914.html">Signal Processing with GW150914</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../detector.html">Gravitational-wave Detectors</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../psd.html">Handling PSDs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../noise.html">Generating Noise</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../waveform.html">Waveforms</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../filter.html">Filtering</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../distributions.html">Using PyCBC Distributions from PyCBC Inference</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../building_bundled_executables.html">Building Bundled Executables</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../documentation.html">Documenting PyCBC code</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../release.html">Creating Releases of PyCBC</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../formats/hdf_format.html">HDF files within the PyCBC workflow</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../workflow.html">Workflow: the inspiral analysis workflow generator (<code class="docutils literal notranslate"><span class="pre">pycbc.workflow</span></code>)</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../modules.html">pycbc</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../build_gh_pages.html">Building Documentation for GitHub Pages</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">PyCBC</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="../../index.html">Module code</a> &raquo;</li>
      <li>ligo.lw.lsctables</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for ligo.lw.lsctables</h1><div class="highlight"><pre>
<span></span><span class="c1"># Copyright (C) 2006--2019  Kipp Cannon</span>
<span class="c1">#</span>
<span class="c1"># This program is free software; you can redistribute it and/or modify it</span>
<span class="c1"># under the terms of the GNU General Public License as published by the</span>
<span class="c1"># Free Software Foundation; either version 3 of the License, or (at your</span>
<span class="c1"># option) any later version.</span>
<span class="c1">#</span>
<span class="c1"># This program is distributed in the hope that it will be useful, but</span>
<span class="c1"># WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<span class="c1"># MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General</span>
<span class="c1"># Public License for more details.</span>
<span class="c1">#</span>
<span class="c1"># You should have received a copy of the GNU General Public License along</span>
<span class="c1"># with this program; if not, write to the Free Software Foundation, Inc.,</span>
<span class="c1"># 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.</span>


<span class="c1">#</span>
<span class="c1"># =============================================================================</span>
<span class="c1">#</span>
<span class="c1">#                                   Preamble</span>
<span class="c1">#</span>
<span class="c1"># =============================================================================</span>
<span class="c1">#</span>


<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">LSC Table definitions.</span>

<span class="sd">See the LDAS CVS repository at</span>
<span class="sd">http://www.ldas-sw.ligo.caltech.edu/cgi-bin/cvsweb.cgi/ldas/dbms/db2/sql</span>
<span class="sd">for more information.</span>


<span class="sd">Customization</span>
<span class="sd">-------------</span>

<span class="sd">In some cases, applications will need to define sub-classes of the table</span>
<span class="sd">and row classes found here or will need to define their own custom tables</span>
<span class="sd">altogether.  Once the custom classes are defined, the following steps are</span>
<span class="sd">required to incorporate them into this module&#39;s document handling</span>
<span class="sd">machinery.</span>

<span class="sd">Firstly, if a new Table class is defined, the TableByName mapping defined</span>
<span class="sd">in this module should be updated.  The TableByName mapping is used to map</span>
<span class="sd">table names to corresponding Python classes.  This mapping is used when</span>
<span class="sd">parsing XML documents, when extracting the contents of SQL databases and</span>
<span class="sd">any other place the conversion from a name to a class definition is</span>
<span class="sd">required.  Once the mapping is updated, XML documents containing Table</span>
<span class="sd">elements whose names match the custom definition will be converted to</span>
<span class="sd">instances of that class (Tables whose names are not recognized are loaded</span>
<span class="sd">as instances of the generic ligo.lw.Table class).</span>

<span class="sd">Example:</span>

<span class="sd">&gt;&gt;&gt; class MyCustomTable(table.Table):</span>
<span class="sd">...	tableName = &quot;custom&quot;</span>
<span class="sd">...</span>
<span class="sd">&gt;&gt;&gt; TableByName[MyCustomTable.tableName] = MyCustomTable</span>

<span class="sd">The row type to be used with a table is selected using the .RowType</span>
<span class="sd">attribute of the corresponding Table class.  When parsing an XML document</span>
<span class="sd">the text is converted into row objects, each of which is created by calling</span>
<span class="sd">the .RowType attribute with no arguments.</span>

<span class="sd">Example:</span>

<span class="sd">&gt;&gt;&gt; class MyCustomTableRow(table.Table.RowType):</span>
<span class="sd">...	pass</span>
<span class="sd">...</span>
<span class="sd">&gt;&gt;&gt; MyCustomTable.RowType = MyCustomTableRow</span>
<span class="sd">&quot;&quot;&quot;</span>


<span class="kn">import</span> <span class="nn">functools</span>
<span class="kn">import</span> <span class="nn">itertools</span>
<span class="kn">import</span> <span class="nn">math</span>
<span class="kn">import</span> <span class="nn">numpy</span>
<span class="kn">import</span> <span class="nn">operator</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">socket</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">warnings</span>
<span class="kn">from</span> <span class="nn">xml</span> <span class="kn">import</span> <span class="n">sax</span>


<span class="kn">from</span> <span class="nn">ligo</span> <span class="kn">import</span> <span class="n">segments</span>
<span class="kn">import</span> <span class="nn">lal</span>
<span class="kn">from</span> <span class="nn">lal</span> <span class="kn">import</span> <span class="n">LIGOTimeGPS</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">__author__</span><span class="p">,</span> <span class="n">__date__</span><span class="p">,</span> <span class="n">__version__</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">ligolw</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">table</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">types</span> <span class="k">as</span> <span class="n">ligolwtypes</span>


<span class="c1">#</span>
<span class="c1"># =============================================================================</span>
<span class="c1">#</span>
<span class="c1">#                            Convenience Functions</span>
<span class="c1">#</span>
<span class="c1"># =============================================================================</span>
<span class="c1">#</span>


<span class="k">def</span> <span class="nf">New</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">columns</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">	Construct a pre-defined LSC table.  The optional columns argument</span>
<span class="sd">	is a sequence of the names of the columns the table is to be</span>
<span class="sd">	constructed with.  If columns = None, then the table is constructed</span>
<span class="sd">	with all valid columns (use columns = [] to create a table with no</span>
<span class="sd">	columns).</span>

<span class="sd">	Example:</span>

<span class="sd">	&gt;&gt;&gt; import sys</span>
<span class="sd">	&gt;&gt;&gt; tbl = New(ProcessTable, [u&quot;process_id&quot;, u&quot;start_time&quot;, u&quot;end_time&quot;, u&quot;comment&quot;])</span>
<span class="sd">	&gt;&gt;&gt; tbl.write(sys.stdout)	# doctest: +NORMALIZE_WHITESPACE</span>
<span class="sd">	&lt;Table Name=&quot;process:table&quot;&gt;</span>
<span class="sd">		&lt;Column Name=&quot;process_id&quot; Type=&quot;int_8s&quot;/&gt;</span>
<span class="sd">		&lt;Column Name=&quot;start_time&quot; Type=&quot;int_4s&quot;/&gt;</span>
<span class="sd">		&lt;Column Name=&quot;end_time&quot; Type=&quot;int_4s&quot;/&gt;</span>
<span class="sd">		&lt;Column Name=&quot;comment&quot; Type=&quot;lstring&quot;/&gt;</span>
<span class="sd">		&lt;Stream Name=&quot;process:table&quot; Delimiter=&quot;,&quot; Type=&quot;Local&quot;&gt;</span>
<span class="sd">		&lt;/Stream&gt;</span>
<span class="sd">	&lt;/Table&gt;</span>
<span class="sd">	&quot;&quot;&quot;</span>
	<span class="n">new</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">(</span><span class="n">sax</span><span class="o">.</span><span class="n">xmlreader</span><span class="o">.</span><span class="n">AttributesImpl</span><span class="p">({</span><span class="sa">u</span><span class="s2">&quot;Name&quot;</span><span class="p">:</span> <span class="bp">cls</span><span class="o">.</span><span class="n">TableName</span><span class="o">.</span><span class="n">enc</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">tableName</span><span class="p">)}),</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
	<span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">columns</span> <span class="k">if</span> <span class="n">columns</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">new</span><span class="o">.</span><span class="n">validcolumns</span><span class="p">):</span>
		<span class="n">new</span><span class="o">.</span><span class="n">appendColumn</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
	<span class="n">new</span><span class="o">.</span><span class="n">_end_of_columns</span><span class="p">()</span>
	<span class="n">new</span><span class="o">.</span><span class="n">appendChild</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">TableStream</span><span class="p">(</span><span class="n">sax</span><span class="o">.</span><span class="n">xmlreader</span><span class="o">.</span><span class="n">AttributesImpl</span><span class="p">({</span><span class="sa">u</span><span class="s2">&quot;Name&quot;</span><span class="p">:</span> <span class="n">new</span><span class="o">.</span><span class="n">getAttribute</span><span class="p">(</span><span class="sa">u</span><span class="s2">&quot;Name&quot;</span><span class="p">),</span> <span class="sa">u</span><span class="s2">&quot;Delimiter&quot;</span><span class="p">:</span> <span class="n">table</span><span class="o">.</span><span class="n">TableStream</span><span class="o">.</span><span class="n">Delimiter</span><span class="o">.</span><span class="n">default</span><span class="p">,</span> <span class="sa">u</span><span class="s2">&quot;Type&quot;</span><span class="p">:</span> <span class="n">table</span><span class="o">.</span><span class="n">TableStream</span><span class="o">.</span><span class="n">Type</span><span class="o">.</span><span class="n">default</span><span class="p">})))</span>
	<span class="k">return</span> <span class="n">new</span>


<span class="k">def</span> <span class="nf">HasNonLSCTables</span><span class="p">(</span><span class="n">elem</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">	Return True if the document tree below elem contains non-LSC</span>
<span class="sd">	tables, otherwise return False.</span>
<span class="sd">	&quot;&quot;&quot;</span>
	<span class="k">return</span> <span class="nb">any</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">Name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">TableByName</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">elem</span><span class="o">.</span><span class="n">getElementsByTagName</span><span class="p">(</span><span class="n">ligolw</span><span class="o">.</span><span class="n">Table</span><span class="o">.</span><span class="n">tagName</span><span class="p">))</span>


<span class="k">class</span> <span class="nc">instrumentsproperty</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
	<span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>

	<span class="nd">@staticmethod</span>
	<span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="n">ifos</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Parse the values stored in the &quot;ifos&quot; and &quot;instruments&quot;</span>
<span class="sd">		columns found in many tables.  This function is mostly for</span>
<span class="sd">		internal use by the .instruments properties of the</span>
<span class="sd">		corresponding row classes.  The mapping from input to</span>
<span class="sd">		output is as follows (rules are applied in order):</span>

<span class="sd">		input is None --&gt; output is None</span>

<span class="sd">		input contains &quot;,&quot; --&gt; output is set of strings split on</span>
<span class="sd">		&quot;,&quot; with leading and trailing whitespace stripped from each</span>
<span class="sd">		piece and empty strings removed from the set</span>

<span class="sd">		input contains &quot;+&quot; --&gt; output is set of strings split on</span>
<span class="sd">		&quot;+&quot; with leading and trailing whitespace stripped from each</span>
<span class="sd">		piece and empty strings removed from the set</span>

<span class="sd">		else, after stripping input of leading and trailing</span>
<span class="sd">		whitespace,</span>

<span class="sd">		input has an even length greater than two --&gt; output is set</span>
<span class="sd">		of two-character pieces</span>

<span class="sd">		input is a non-empty string --&gt; output is a set containing</span>
<span class="sd">		input as single value</span>

<span class="sd">		else output is an empty set.</span>

<span class="sd">		NOTE:  the complexity of this algorithm is a consequence of</span>
<span class="sd">		there being several conventions in use for encoding a set</span>
<span class="sd">		of instruments into one of these columns;  it has been</span>
<span class="sd">		proposed that L.L.W.  documents standardize on the</span>
<span class="sd">		comma-delimited variant of the encodings recognized by this</span>
<span class="sd">		function, and for this reason the inverse function,</span>
<span class="sd">		instrumentsproperty.set(), implements that encoding only.</span>

<span class="sd">		NOTE:  to force a string containing an even number of</span>
<span class="sd">		characters to be interpreted as a single instrument name</span>
<span class="sd">		and not to be be split into two-character pieces, add a &quot;,&quot;</span>
<span class="sd">		character to the end to force the comma-delimited decoding</span>
<span class="sd">		to be used.  instrumentsproperty.set() does this for you.</span>

<span class="sd">		Example:</span>

<span class="sd">		&gt;&gt;&gt; print(instrumentsproperty.get(None))</span>
<span class="sd">		None</span>
<span class="sd">		&gt;&gt;&gt; assert instrumentsproperty.get(u&quot;&quot;) == set([])</span>
<span class="sd">		&gt;&gt;&gt; assert instrumentsproperty.get(u&quot;  ,  ,,&quot;) == set([])</span>
<span class="sd">		&gt;&gt;&gt; assert instrumentsproperty.get(u&quot;H1&quot;) == set([u&#39;H1&#39;])</span>
<span class="sd">		&gt;&gt;&gt; assert instrumentsproperty.get(u&quot;SWIFT&quot;) == set([u&#39;SWIFT&#39;])</span>
<span class="sd">		&gt;&gt;&gt; assert instrumentsproperty.get(u&quot;H1L1&quot;) == set([u&#39;H1&#39;, u&#39;L1&#39;])</span>
<span class="sd">		&gt;&gt;&gt; assert instrumentsproperty.get(u&quot;H1L1,&quot;) == set([u&#39;H1L1&#39;])</span>
<span class="sd">		&gt;&gt;&gt; assert instrumentsproperty.get(u&quot;H1,L1&quot;) == set([u&#39;H1&#39;, u&#39;L1&#39;])</span>
<span class="sd">		&gt;&gt;&gt; assert instrumentsproperty.get(u&quot;H1+L1&quot;) == set([u&#39;H1&#39;, u&#39;L1&#39;])</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="k">if</span> <span class="n">ifos</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
			<span class="k">return</span> <span class="kc">None</span>
		<span class="k">if</span> <span class="sa">u</span><span class="s2">&quot;,&quot;</span> <span class="ow">in</span> <span class="n">ifos</span><span class="p">:</span>
			<span class="n">result</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">ifo</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">ifo</span> <span class="ow">in</span> <span class="n">ifos</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="sa">u</span><span class="s2">&quot;,&quot;</span><span class="p">))</span>
			<span class="n">result</span><span class="o">.</span><span class="n">discard</span><span class="p">(</span><span class="sa">u</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
			<span class="k">return</span> <span class="n">result</span>
		<span class="k">if</span> <span class="sa">u</span><span class="s2">&quot;+&quot;</span> <span class="ow">in</span> <span class="n">ifos</span><span class="p">:</span>
			<span class="n">result</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">ifo</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">ifo</span> <span class="ow">in</span> <span class="n">ifos</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="sa">u</span><span class="s2">&quot;+&quot;</span><span class="p">))</span>
			<span class="n">result</span><span class="o">.</span><span class="n">discard</span><span class="p">(</span><span class="sa">u</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
			<span class="k">return</span> <span class="n">result</span>
		<span class="n">ifos</span> <span class="o">=</span> <span class="n">ifos</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
		<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ifos</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">2</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">len</span><span class="p">(</span><span class="n">ifos</span><span class="p">)</span> <span class="o">%</span> <span class="mi">2</span><span class="p">:</span>
			<span class="c1"># if ifos is a string with an even number of</span>
			<span class="c1"># characters greater than two, split it into</span>
			<span class="c1"># two-character pieces.  FIXME:  remove this when</span>
			<span class="c1"># the inspiral codes don&#39;t write ifos strings like</span>
			<span class="c1"># this anymore</span>
			<span class="k">return</span> <span class="nb">set</span><span class="p">(</span><span class="n">ifos</span><span class="p">[</span><span class="n">n</span><span class="p">:</span><span class="n">n</span><span class="o">+</span><span class="mi">2</span><span class="p">]</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">ifos</span><span class="p">),</span> <span class="mi">2</span><span class="p">))</span>
		<span class="k">if</span> <span class="n">ifos</span><span class="p">:</span>
			<span class="k">return</span> <span class="nb">set</span><span class="p">([</span><span class="n">ifos</span><span class="p">])</span>
		<span class="k">return</span> <span class="nb">set</span><span class="p">()</span>

	<span class="nd">@staticmethod</span>
	<span class="k">def</span> <span class="nf">set</span><span class="p">(</span><span class="n">instruments</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Convert an iterable of instrument names into a value</span>
<span class="sd">		suitable for storage in the &quot;ifos&quot; column found in many</span>
<span class="sd">		tables.  This function is mostly for internal use by the</span>
<span class="sd">		.instruments properties of the corresponding row classes.</span>
<span class="sd">		The input can be None or an iterable of zero or more</span>
<span class="sd">		instrument names, none of which may be zero-length, consist</span>
<span class="sd">		exclusively of spaces, or contain &quot;,&quot; or &quot;+&quot; characters.</span>
<span class="sd">		The output is a single string containing the unique</span>
<span class="sd">		instrument names concatenated using &quot;,&quot; as a delimiter.</span>
<span class="sd">		instruments will only be iterated over once and so can be a</span>
<span class="sd">		generator expression.  Whitespace is allowed in instrument</span>
<span class="sd">		names but might not be preserved.  Repeated names will not</span>
<span class="sd">		be preserved.</span>

<span class="sd">		NOTE:  in the special case that there is 1 instrument name</span>
<span class="sd">		in the iterable and it has an even number of characters &gt; 2</span>
<span class="sd">		in it, the output will have a &quot;,&quot; appended in order to</span>
<span class="sd">		force instrumentsproperty.get() to parse the string back</span>
<span class="sd">		into a single instrument name.  This is a special case</span>
<span class="sd">		included temporarily to disambiguate the encoding until all</span>
<span class="sd">		codes have been ported to the comma-delimited encoding.</span>
<span class="sd">		This behaviour will be discontinued at that time.  DO NOT</span>
<span class="sd">		WRITE CODE THAT RELIES ON THIS!  You have been warned.</span>

<span class="sd">		Example:</span>

<span class="sd">		&gt;&gt;&gt; print(instrumentsproperty.set(None))</span>
<span class="sd">		None</span>
<span class="sd">		&gt;&gt;&gt; assert instrumentsproperty.set(()) == u&#39;&#39;</span>
<span class="sd">		&gt;&gt;&gt; assert instrumentsproperty.set((u&quot;H1&quot;,)) == u&#39;H1&#39;</span>
<span class="sd">		&gt;&gt;&gt; assert instrumentsproperty.set((u&quot;H1&quot;,u&quot;H1&quot;,u&quot;H1&quot;)) == u&#39;H1&#39;</span>
<span class="sd">		&gt;&gt;&gt; assert instrumentsproperty.set((u&quot;H1&quot;,u&quot;L1&quot;)) == u&#39;H1,L1&#39;</span>
<span class="sd">		&gt;&gt;&gt; assert instrumentsproperty.set((u&quot;SWIFT&quot;,)) == u&#39;SWIFT&#39;</span>
<span class="sd">		&gt;&gt;&gt; assert instrumentsproperty.set((u&quot;H1L1&quot;,)) == u&#39;H1L1,&#39;</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="k">if</span> <span class="n">instruments</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
			<span class="k">return</span> <span class="kc">None</span>
		<span class="n">_instruments</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">instrument</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">instrument</span> <span class="ow">in</span> <span class="n">instruments</span><span class="p">))</span>
		<span class="c1"># safety check:  refuse to accept blank names, or names</span>
		<span class="c1"># with commas or pluses in them as they cannot survive the</span>
		<span class="c1"># encode/decode process</span>
		<span class="k">if</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">(</span><span class="n">_instruments</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">any</span><span class="p">(</span><span class="sa">u</span><span class="s2">&quot;,&quot;</span> <span class="ow">in</span> <span class="n">instrument</span> <span class="ow">or</span> <span class="sa">u</span><span class="s2">&quot;+&quot;</span> <span class="ow">in</span> <span class="n">instrument</span> <span class="k">for</span> <span class="n">instrument</span> <span class="ow">in</span> <span class="n">_instruments</span><span class="p">):</span>
			<span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">instruments</span><span class="p">)</span>
		<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">_instruments</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">_instruments</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">2</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">len</span><span class="p">(</span><span class="n">_instruments</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">%</span> <span class="mi">2</span><span class="p">:</span>
			<span class="c1"># special case disambiguation.  FIXME:  remove when</span>
			<span class="c1"># everything uses the comma-delimited encoding</span>
			<span class="k">return</span> <span class="sa">u</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">,&quot;</span> <span class="o">%</span> <span class="n">_instruments</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
		<span class="k">return</span> <span class="sa">u</span><span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">_instruments</span><span class="p">)</span>

	<span class="k">def</span> <span class="fm">__get__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="bp">cls</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
		<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">))</span>

	<span class="k">def</span> <span class="fm">__set__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">instruments</span><span class="p">):</span>
		<span class="nb">setattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">instruments</span><span class="p">))</span>


<span class="k">class</span> <span class="nc">gpsproperty</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">	Descriptor used internally to implement LIGOTimeGPS-valued</span>
<span class="sd">	properties using pairs of integer attributes on row objects, one</span>
<span class="sd">	for the integer seconds part of the GPS time and one for the</span>
<span class="sd">	integer nanoseconds part.</span>

<span class="sd">	Non-LIGOTimeGPS values are converted to LIGOTimeGPS before encoding</span>
<span class="sd">	them into the integer attributes.  None is allowed as a special</span>
<span class="sd">	case, which is encoded by setting both column attributes to None.</span>

<span class="sd">	For the purpose of representing the boundaries of unbounded</span>
<span class="sd">	segments (open-ended time intervals), +inf and -inf are also</span>
<span class="sd">	allowed, and will be encoded into and decoded out of the integer</span>
<span class="sd">	attributes.  To do so, a non-standard encoding is used that makes</span>
<span class="sd">	use of denormalized GPS times, that is times whose nanosecond</span>
<span class="sd">	component has a magnitude greater than 999999999.  Two such values</span>
<span class="sd">	are reserved for +/- infinity.  To guard against the need for</span>
<span class="sd">	additional special encodings in the future, this descriptor</span>
<span class="sd">	reserves all denormalized values and will not allow calling code to</span>
<span class="sd">	set GPS times to those values.  Calling code must provide</span>
<span class="sd">	normalized GPS times, times with nanosecond components whose</span>
<span class="sd">	magnitudes are not greater than 999999999.  When decoded, the</span>
<span class="sd">	values reported are segments.PosInfinity or segments.NegInfinity.</span>
<span class="sd">	&quot;&quot;&quot;</span>
	<span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s_name</span><span class="p">,</span> <span class="n">ns_name</span><span class="p">):</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">s_name</span> <span class="o">=</span> <span class="n">s_name</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">get_s</span> <span class="o">=</span> <span class="n">operator</span><span class="o">.</span><span class="n">attrgetter</span><span class="p">(</span><span class="n">s_name</span><span class="p">)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">ns_name</span> <span class="o">=</span> <span class="n">ns_name</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">get_ns</span> <span class="o">=</span> <span class="n">operator</span><span class="o">.</span><span class="n">attrgetter</span><span class="p">(</span><span class="n">ns_name</span><span class="p">)</span>

	<span class="n">posinf</span> <span class="o">=</span> <span class="mh">0x7FFFFFFF</span><span class="p">,</span> <span class="mh">0xFFFFFFFF</span>
	<span class="n">neginf</span> <span class="o">=</span> <span class="mh">0xFFFFFFFF</span><span class="p">,</span> <span class="mh">0xFFFFFFFF</span>
	<span class="n">infs</span> <span class="o">=</span> <span class="n">posinf</span><span class="p">,</span> <span class="n">neginf</span>

	<span class="k">def</span> <span class="fm">__get__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="bp">cls</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
		<span class="n">s</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_s</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
		<span class="n">ns</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_ns</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
		<span class="k">if</span> <span class="n">s</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">ns</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
			<span class="k">return</span> <span class="kc">None</span>
		<span class="k">if</span> <span class="n">ns</span> <span class="o">==</span> <span class="mh">0xFFFFFFFF</span><span class="p">:</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">ns</span><span class="p">)</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">posinf</span><span class="p">:</span>
				<span class="k">return</span> <span class="n">segments</span><span class="o">.</span><span class="n">PosInfinity</span>
			<span class="k">elif</span> <span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">ns</span><span class="p">)</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">neginf</span><span class="p">:</span>
				<span class="k">return</span> <span class="n">segments</span><span class="o">.</span><span class="n">NegInfinity</span>
			<span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;unrecognized denormalized number LIGOTimeGPS(</span><span class="si">%d</span><span class="s2">,</span><span class="si">%d</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">ns</span><span class="p">))</span>
		<span class="k">return</span> <span class="n">LIGOTimeGPS</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">ns</span><span class="p">)</span>

	<span class="k">def</span> <span class="fm">__set__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">gps</span><span class="p">):</span>
		<span class="k">if</span> <span class="n">gps</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
			<span class="n">s</span> <span class="o">=</span> <span class="n">ns</span> <span class="o">=</span> <span class="kc">None</span>
		<span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">gps</span><span class="p">,</span> <span class="n">segments</span><span class="o">.</span><span class="n">infinity</span><span class="p">)</span> <span class="ow">or</span> <span class="n">math</span><span class="o">.</span><span class="n">isinf</span><span class="p">(</span><span class="n">gps</span><span class="p">):</span>
			<span class="k">if</span> <span class="n">gps</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
				<span class="n">s</span><span class="p">,</span> <span class="n">ns</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">posinf</span>
			<span class="k">elif</span> <span class="n">gps</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
				<span class="n">s</span><span class="p">,</span> <span class="n">ns</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">neginf</span>
			<span class="k">else</span><span class="p">:</span>
				<span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">gps</span><span class="p">)</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="k">try</span><span class="p">:</span>
				<span class="n">s</span> <span class="o">=</span> <span class="n">gps</span><span class="o">.</span><span class="n">gpsSeconds</span>
				<span class="n">ns</span> <span class="o">=</span> <span class="n">gps</span><span class="o">.</span><span class="n">gpsNanoSeconds</span>
			<span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
				<span class="c1"># try converting and going again</span>
				<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="fm">__set__</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">LIGOTimeGPS</span><span class="p">(</span><span class="n">gps</span><span class="p">))</span>
			<span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">ns</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">999999999</span><span class="p">:</span>
				<span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;denormalized LIGOTimeGPS not allowed: LIGOTimeGPS(</span><span class="si">%d</span><span class="s2">, </span><span class="si">%d</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">ns</span><span class="p">))</span>
		<span class="nb">setattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">s_name</span><span class="p">,</span> <span class="n">s</span><span class="p">)</span>
		<span class="nb">setattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ns_name</span><span class="p">,</span> <span class="n">ns</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">gpsproperty_with_gmst</span><span class="p">(</span><span class="n">gpsproperty</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">	Variant of the gpsproperty descriptor, adding support for a third</span>
<span class="sd">	&quot;GMST&quot; column.  When assigning a time to the GPS-valued descriptor,</span>
<span class="sd">	after the pair of integer attributes are set to the encoded form of</span>
<span class="sd">	the GPS time, the value is retrieved and the GMST column is set to</span>
<span class="sd">	the Greenwhich mean sidereal time corresponding to that GPS time.</span>
<span class="sd">	Note that the conversion to sidereal time is performed after</span>
<span class="sd">	encoding the GPS time into the integer seconds and nanoseconds</span>
<span class="sd">	attributes, so the sidereal time will reflect any rounding that has</span>
<span class="sd">	occured as a result of that encoding.  If the GPS time is set to</span>
<span class="sd">	None or +inf or -inf, the sidereal time is set to that value as</span>
<span class="sd">	well.</span>
<span class="sd">	&quot;&quot;&quot;</span>
	<span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s_name</span><span class="p">,</span> <span class="n">ns_name</span><span class="p">,</span> <span class="n">gmst_name</span><span class="p">):</span>
		<span class="nb">super</span><span class="p">(</span><span class="n">gpsproperty_with_gmst</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">s_name</span><span class="p">,</span> <span class="n">ns_name</span><span class="p">)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">gmst_name</span> <span class="o">=</span> <span class="n">gmst_name</span>

	<span class="k">def</span> <span class="fm">__set__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">gps</span><span class="p">):</span>
		<span class="nb">super</span><span class="p">(</span><span class="n">gpsproperty_with_gmst</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__set__</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">gps</span><span class="p">)</span>
		<span class="k">if</span> <span class="n">gps</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
			<span class="nb">setattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">gmst_name</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="c1"># re-retrieve the value in case it required type</span>
			<span class="c1"># conversion</span>
			<span class="n">gps</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="fm">__get__</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
			<span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">gps</span><span class="p">,</span> <span class="n">segments</span><span class="o">.</span><span class="n">infinity</span><span class="p">):</span>
				<span class="nb">setattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">gmst_name</span><span class="p">,</span> <span class="n">lal</span><span class="o">.</span><span class="n">GreenwichMeanSiderealTime</span><span class="p">(</span><span class="n">gps</span><span class="p">))</span>
			<span class="k">elif</span> <span class="n">gps</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
				<span class="nb">setattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">gmst_name</span><span class="p">,</span> <span class="nb">float</span><span class="p">(</span><span class="s2">&quot;+inf&quot;</span><span class="p">))</span>
			<span class="k">elif</span> <span class="n">gps</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
				<span class="nb">setattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">gmst_name</span><span class="p">,</span> <span class="nb">float</span><span class="p">(</span><span class="s2">&quot;-inf&quot;</span><span class="p">))</span>
			<span class="k">else</span><span class="p">:</span>
				<span class="c1"># this should be impossible</span>
				<span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">gps</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">segmentproperty</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">	Descriptor used internally to expose pairs of GPS-valued properties</span>
<span class="sd">	as segment-valued properties.  A segment may be set to None, which</span>
<span class="sd">	is encoded by setting both GPS-valued properties to None.  Likewise</span>
<span class="sd">	if both GPS-valued properties are set to None then the value</span>
<span class="sd">	reported by this descriptor is None, not (None, None).</span>

<span class="sd">	See the documentation for gpsproperty for more information on the</span>
<span class="sd">	encodings it uses for special values and the limitations they</span>
<span class="sd">	create.</span>
<span class="sd">	&quot;&quot;&quot;</span>
	<span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">start_name</span><span class="p">,</span> <span class="n">stop_name</span><span class="p">):</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">start</span> <span class="o">=</span> <span class="n">start_name</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">stop</span> <span class="o">=</span> <span class="n">stop_name</span>

	<span class="k">def</span> <span class="fm">__get__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="bp">cls</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
		<span class="n">start</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">start</span><span class="p">)</span>
		<span class="n">stop</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">stop</span><span class="p">)</span>
		<span class="k">if</span> <span class="n">start</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">stop</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
			<span class="k">return</span> <span class="kc">None</span>
		<span class="k">return</span> <span class="n">segments</span><span class="o">.</span><span class="n">segment</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">stop</span><span class="p">)</span>

	<span class="k">def</span> <span class="fm">__set__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">seg</span><span class="p">):</span>
		<span class="k">if</span> <span class="n">seg</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
			<span class="n">start</span> <span class="o">=</span> <span class="n">stop</span> <span class="o">=</span> <span class="kc">None</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="n">start</span><span class="p">,</span> <span class="n">stop</span> <span class="o">=</span> <span class="n">seg</span>
		<span class="nb">setattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">start</span><span class="p">,</span> <span class="n">start</span><span class="p">)</span>
		<span class="nb">setattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">stop</span><span class="p">,</span> <span class="n">stop</span><span class="p">)</span>


<span class="c1">#</span>
<span class="c1"># =============================================================================</span>
<span class="c1">#</span>
<span class="c1">#                                process:table</span>
<span class="c1">#</span>
<span class="c1"># =============================================================================</span>
<span class="c1">#</span>


<span class="n">ProcessID</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="n">next_id</span><span class="o">.</span><span class="n">type</span><span class="p">(</span><span class="sa">u</span><span class="s2">&quot;process_id&quot;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">ProcessTable</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">Table</span><span class="p">):</span>
	<span class="n">tableName</span> <span class="o">=</span> <span class="s2">&quot;process&quot;</span>
	<span class="n">validcolumns</span> <span class="o">=</span> <span class="p">{</span>
		<span class="s2">&quot;program&quot;</span><span class="p">:</span> <span class="s2">&quot;lstring&quot;</span><span class="p">,</span>
		<span class="s2">&quot;version&quot;</span><span class="p">:</span> <span class="s2">&quot;lstring&quot;</span><span class="p">,</span>
		<span class="s2">&quot;cvs_repository&quot;</span><span class="p">:</span> <span class="s2">&quot;lstring&quot;</span><span class="p">,</span>
		<span class="s2">&quot;cvs_entry_time&quot;</span><span class="p">:</span> <span class="s2">&quot;int_4s&quot;</span><span class="p">,</span>
		<span class="s2">&quot;comment&quot;</span><span class="p">:</span> <span class="s2">&quot;lstring&quot;</span><span class="p">,</span>
		<span class="s2">&quot;is_online&quot;</span><span class="p">:</span> <span class="s2">&quot;int_4s&quot;</span><span class="p">,</span>
		<span class="s2">&quot;node&quot;</span><span class="p">:</span> <span class="s2">&quot;lstring&quot;</span><span class="p">,</span>
		<span class="s2">&quot;username&quot;</span><span class="p">:</span> <span class="s2">&quot;lstring&quot;</span><span class="p">,</span>
		<span class="s2">&quot;unix_procid&quot;</span><span class="p">:</span> <span class="s2">&quot;int_4s&quot;</span><span class="p">,</span>
		<span class="s2">&quot;start_time&quot;</span><span class="p">:</span> <span class="s2">&quot;int_4s&quot;</span><span class="p">,</span>
		<span class="s2">&quot;end_time&quot;</span><span class="p">:</span> <span class="s2">&quot;int_4s&quot;</span><span class="p">,</span>
		<span class="s2">&quot;jobid&quot;</span><span class="p">:</span> <span class="s2">&quot;int_4s&quot;</span><span class="p">,</span>
		<span class="s2">&quot;domain&quot;</span><span class="p">:</span> <span class="s2">&quot;lstring&quot;</span><span class="p">,</span>
		<span class="s2">&quot;ifos&quot;</span><span class="p">:</span> <span class="s2">&quot;lstring&quot;</span><span class="p">,</span>
		<span class="s2">&quot;process_id&quot;</span><span class="p">:</span> <span class="s2">&quot;int_8s&quot;</span>
	<span class="p">}</span>
	<span class="n">constraints</span> <span class="o">=</span> <span class="s2">&quot;PRIMARY KEY (process_id)&quot;</span>
	<span class="n">next_id</span> <span class="o">=</span> <span class="n">ProcessID</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

	<span class="k">def</span> <span class="nf">get_ids_by_program</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">program</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Return a set containing the process IDs from rows whose</span>
<span class="sd">		program string equals the given program.</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="k">return</span> <span class="nb">set</span><span class="p">(</span><span class="n">row</span><span class="o">.</span><span class="n">process_id</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="bp">self</span> <span class="k">if</span> <span class="n">row</span><span class="o">.</span><span class="n">program</span> <span class="o">==</span> <span class="n">program</span><span class="p">)</span>

	<span class="nd">@staticmethod</span>
	<span class="k">def</span> <span class="nf">get_username</span><span class="p">():</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Utility to help retrieve a sensible value for the current</span>
<span class="sd">		username.  First the environment variable LOGNAME is tried,</span>
<span class="sd">		if that is not set the environment variable USERNAME is</span>
<span class="sd">		tried, if that is not set the password database is</span>
<span class="sd">		consulted (only on Unix systems, if the import of the pwd</span>
<span class="sd">		module succeeds), finally if that fails KeyError is raised.</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="k">try</span><span class="p">:</span>
			<span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;LOGNAME&quot;</span><span class="p">]</span>
		<span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
			<span class="k">pass</span>
		<span class="k">try</span><span class="p">:</span>
			<span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;USERNAME&quot;</span><span class="p">]</span>
		<span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
			<span class="k">pass</span>
		<span class="k">try</span><span class="p">:</span>
			<span class="kn">import</span> <span class="nn">pwd</span>
			<span class="k">return</span> <span class="n">pwd</span><span class="o">.</span><span class="n">getpwuid</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getuid</span><span class="p">())[</span><span class="mi">0</span><span class="p">]</span>
		<span class="k">except</span> <span class="p">(</span><span class="ne">ImportError</span><span class="p">,</span> <span class="ne">KeyError</span><span class="p">):</span>
			<span class="k">raise</span> <span class="ne">KeyError</span>


<span class="k">class</span> <span class="nc">Process</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">Table</span><span class="o">.</span><span class="n">RowType</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">	Example:</span>

<span class="sd">	&gt;&gt;&gt; x = Process()</span>
<span class="sd">	&gt;&gt;&gt; x.instruments = (u&quot;H1&quot;, u&quot;L1&quot;)</span>
<span class="sd">	&gt;&gt;&gt; assert x.ifos == u&#39;H1,L1&#39;</span>
<span class="sd">	&gt;&gt;&gt; assert x.instruments == set([u&#39;H1&#39;, u&#39;L1&#39;])</span>
<span class="sd">	&gt;&gt;&gt; # truncates to integers</span>
<span class="sd">	&gt;&gt;&gt; x.start = 10.5</span>
<span class="sd">	&gt;&gt;&gt; x.start</span>
<span class="sd">	LIGOTimeGPS(10, 0)</span>
<span class="sd">	&gt;&gt;&gt; x.end = 20.5</span>
<span class="sd">	&gt;&gt;&gt; x.end</span>
<span class="sd">	LIGOTimeGPS(20, 0)</span>
<span class="sd">	&gt;&gt;&gt; x.segment</span>
<span class="sd">	segment(LIGOTimeGPS(10, 0), LIGOTimeGPS(20, 0))</span>
<span class="sd">	&quot;&quot;&quot;</span>
	<span class="vm">__slots__</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">Column</span><span class="o">.</span><span class="n">ColumnName</span><span class="p">,</span> <span class="n">ProcessTable</span><span class="o">.</span><span class="n">validcolumns</span><span class="p">))</span>

	<span class="nd">@property</span>
	<span class="k">def</span> <span class="nf">start_time_ns</span><span class="p">(</span><span class="n">eslf</span><span class="p">):</span>
		<span class="k">return</span> <span class="mi">0</span>
	<span class="nd">@start_time_ns</span><span class="o">.</span><span class="n">setter</span>
	<span class="k">def</span> <span class="nf">start_time_ns</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
		<span class="k">pass</span>

	<span class="nd">@property</span>
	<span class="k">def</span> <span class="nf">end_time_ns</span><span class="p">(</span><span class="n">eslf</span><span class="p">):</span>
		<span class="k">return</span> <span class="mi">0</span>
	<span class="nd">@end_time_ns</span><span class="o">.</span><span class="n">setter</span>
	<span class="k">def</span> <span class="nf">end_time_ns</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
		<span class="k">pass</span>

	<span class="n">instruments</span> <span class="o">=</span> <span class="n">instrumentsproperty</span><span class="p">(</span><span class="s2">&quot;ifos&quot;</span><span class="p">)</span>
	<span class="n">start</span> <span class="o">=</span> <span class="n">gpsproperty</span><span class="p">(</span><span class="s2">&quot;start_time&quot;</span><span class="p">,</span> <span class="s2">&quot;start_time_ns&quot;</span><span class="p">)</span>
	<span class="n">end</span> <span class="o">=</span> <span class="n">gpsproperty</span><span class="p">(</span><span class="s2">&quot;end_time&quot;</span><span class="p">,</span> <span class="s2">&quot;end_time_ns&quot;</span><span class="p">)</span>
	<span class="n">segment</span> <span class="o">=</span> <span class="n">segmentproperty</span><span class="p">(</span><span class="s2">&quot;start&quot;</span><span class="p">,</span> <span class="s2">&quot;end&quot;</span><span class="p">)</span>

	<span class="nd">@classmethod</span>
	<span class="k">def</span> <span class="nf">initialized</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">program</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">version</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">cvs_repository</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">cvs_entry_time</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">comment</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">is_online</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">jobid</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">domain</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">instruments</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">process_id</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Create a new Process object and initialize its attributes</span>
<span class="sd">		to sensible defaults.  If not None, program, version,</span>
<span class="sd">		cvs_repository, comment, and domain should all be strings</span>
<span class="sd">		or unicodes.  If cvs_entry_time is not None, it must be a</span>
<span class="sd">		string or unicode in the format &quot;YYYY-MM-DD HH:MM:SS&quot;.</span>
<span class="sd">		is_online should be boolean, jobid an integer.  If not</span>
<span class="sd">		None, instruments must be an iterable (set, tuple, etc.) of</span>
<span class="sd">		instrument names (strings or unicodes).</span>

<span class="sd">		In addition, .node is set to the current hostname,</span>
<span class="sd">		.unix_procid is set to the current process ID, .username is</span>
<span class="sd">		set to the current user&#39;s name, .start_time is set to the</span>
<span class="sd">		current GPS time.</span>

<span class="sd">		Note:  if the process_id keyword argument is None (the</span>
<span class="sd">		default), then the process_id attribute is not set, it is</span>
<span class="sd">		left uninitialized rather than setting it to None.  It must</span>
<span class="sd">		be initialized before the row object can be written to a</span>
<span class="sd">		file, and so in this way the calling code is required to</span>
<span class="sd">		provide a proper value for it.</span>

<span class="sd">		Example:</span>

<span class="sd">		&gt;&gt;&gt; process = Process.initialized()</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="bp">self</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">(</span>
			<span class="n">program</span> <span class="o">=</span> <span class="n">program</span><span class="p">,</span>
			<span class="n">version</span> <span class="o">=</span> <span class="n">version</span><span class="p">,</span>
			<span class="n">cvs_repository</span> <span class="o">=</span> <span class="n">cvs_repository</span><span class="p">,</span>
			<span class="n">cvs_entry_time</span> <span class="o">=</span> <span class="n">lal</span><span class="o">.</span><span class="n">UTCToGPS</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">cvs_entry_time</span><span class="p">,</span> <span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2"> %H:%M:%S +0000&quot;</span><span class="p">))</span> <span class="k">if</span> <span class="n">cvs_entry_time</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
			<span class="n">comment</span> <span class="o">=</span> <span class="n">comment</span><span class="p">,</span>
			<span class="n">is_online</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">is_online</span><span class="p">),</span>
			<span class="n">node</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="n">gethostname</span><span class="p">(),</span>
			<span class="n">unix_procid</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getpid</span><span class="p">(),</span>
			<span class="n">start_time</span> <span class="o">=</span> <span class="n">lal</span><span class="o">.</span><span class="n">UTCToGPS</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">gmtime</span><span class="p">()),</span>
			<span class="n">end_time</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
			<span class="n">jobid</span> <span class="o">=</span> <span class="n">jobid</span><span class="p">,</span>
			<span class="n">domain</span> <span class="o">=</span> <span class="n">domain</span><span class="p">,</span>
			<span class="n">instruments</span> <span class="o">=</span> <span class="n">instruments</span>
		<span class="p">)</span>
		<span class="k">try</span><span class="p">:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">username</span> <span class="o">=</span> <span class="n">ProcessTable</span><span class="o">.</span><span class="n">get_username</span><span class="p">()</span>
		<span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">username</span> <span class="o">=</span> <span class="kc">None</span>
		<span class="k">if</span> <span class="n">process_id</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">process_id</span> <span class="o">=</span> <span class="n">process_id</span>
		<span class="k">return</span> <span class="bp">self</span>

	<span class="k">def</span> <span class="nf">set_end_time_now</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Set .end_time to the current GPS time.</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">end_time</span> <span class="o">=</span> <span class="n">lal</span><span class="o">.</span><span class="n">UTCToGPS</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">gmtime</span><span class="p">())</span>


<span class="n">ProcessTable</span><span class="o">.</span><span class="n">RowType</span> <span class="o">=</span> <span class="n">Process</span>


<span class="c1">#</span>
<span class="c1"># =============================================================================</span>
<span class="c1">#</span>
<span class="c1">#                             process_params:table</span>
<span class="c1">#</span>
<span class="c1"># =============================================================================</span>
<span class="c1">#</span>


<span class="k">class</span> <span class="nc">ProcessParamsTable</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">Table</span><span class="p">):</span>
	<span class="n">tableName</span> <span class="o">=</span> <span class="s2">&quot;process_params&quot;</span>
	<span class="n">validcolumns</span> <span class="o">=</span> <span class="p">{</span>
		<span class="s2">&quot;program&quot;</span><span class="p">:</span> <span class="s2">&quot;lstring&quot;</span><span class="p">,</span>
		<span class="s2">&quot;process:process_id&quot;</span><span class="p">:</span> <span class="s2">&quot;int_8s&quot;</span><span class="p">,</span>
		<span class="s2">&quot;param&quot;</span><span class="p">:</span> <span class="s2">&quot;lstring&quot;</span><span class="p">,</span>
		<span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;lstring&quot;</span><span class="p">,</span>
		<span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="s2">&quot;lstring&quot;</span>
	<span class="p">}</span>
	<span class="c1"># FIXME: these constraints break ID remapping in the DB backend.</span>
	<span class="c1"># an index is used instead.  switch back to the constraints when I</span>
	<span class="c1"># can figure out how not to break remapping.</span>
	<span class="c1">#constraints = &quot;PRIMARY KEY (process_id, param)&quot;</span>
	<span class="n">how_to_index</span> <span class="o">=</span> <span class="p">{</span>
		<span class="s2">&quot;pp_pip_index&quot;</span><span class="p">:</span> <span class="p">(</span><span class="s2">&quot;process_id&quot;</span><span class="p">,</span> <span class="s2">&quot;param&quot;</span><span class="p">),</span>
	<span class="p">}</span>

	<span class="k">def</span> <span class="nf">append</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">row</span><span class="p">):</span>
		<span class="k">if</span> <span class="n">row</span><span class="o">.</span><span class="n">type</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">row</span><span class="o">.</span><span class="n">type</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ligolwtypes</span><span class="o">.</span><span class="n">Types</span><span class="p">:</span>
			<span class="k">raise</span> <span class="n">ligolw</span><span class="o">.</span><span class="n">ElementError</span><span class="p">(</span><span class="s2">&quot;unrecognized type &#39;</span><span class="si">%s</span><span class="s2">&#39; for process </span><span class="si">%d</span><span class="s2"> param &#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">row</span><span class="o">.</span><span class="n">type</span><span class="p">,</span> <span class="n">row</span><span class="o">.</span><span class="n">process_id</span><span class="p">,</span> <span class="n">row</span><span class="o">.</span><span class="n">param</span><span class="p">))</span>
		<span class="nb">super</span><span class="p">(</span><span class="n">ProcessParamsTable</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">ProcessParams</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">Table</span><span class="o">.</span><span class="n">RowType</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">	Example:</span>

<span class="sd">	&gt;&gt;&gt; x = ProcessParams()</span>
<span class="sd">	&gt;&gt;&gt; x.pyvalue = u&quot;test&quot;</span>
<span class="sd">	&gt;&gt;&gt; print(x.type)</span>
<span class="sd">	lstring</span>
<span class="sd">	&gt;&gt;&gt; print(x.value)</span>
<span class="sd">	test</span>
<span class="sd">	&gt;&gt;&gt; print(x.pyvalue)</span>
<span class="sd">	test</span>
<span class="sd">	&gt;&gt;&gt; x.pyvalue = 6.</span>
<span class="sd">	&gt;&gt;&gt; print(x.type)</span>
<span class="sd">	real_8</span>
<span class="sd">	&gt;&gt;&gt; assert x.value == u&#39;6&#39;</span>
<span class="sd">	&gt;&gt;&gt; print(x.pyvalue)</span>
<span class="sd">	6.0</span>
<span class="sd">	&gt;&gt;&gt; x.pyvalue = None</span>
<span class="sd">	&gt;&gt;&gt; print(x.type)</span>
<span class="sd">	None</span>
<span class="sd">	&gt;&gt;&gt; print(x.value)</span>
<span class="sd">	None</span>
<span class="sd">	&gt;&gt;&gt; print(x.pyvalue)</span>
<span class="sd">	None</span>
<span class="sd">	&gt;&gt;&gt; x.pyvalue = True</span>
<span class="sd">	&gt;&gt;&gt; print(x.type)</span>
<span class="sd">	int_4s</span>
<span class="sd">	&gt;&gt;&gt; assert x.value == u&#39;1&#39;</span>
<span class="sd">	&gt;&gt;&gt; x.pyvalue</span>
<span class="sd">	1</span>
<span class="sd">	&quot;&quot;&quot;</span>
	<span class="vm">__slots__</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">Column</span><span class="o">.</span><span class="n">ColumnName</span><span class="p">,</span> <span class="n">ProcessParamsTable</span><span class="o">.</span><span class="n">validcolumns</span><span class="p">))</span>

	<span class="nd">@property</span>
	<span class="k">def</span> <span class="nf">pyvalue</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
			<span class="k">return</span> <span class="kc">None</span>
		<span class="k">try</span><span class="p">:</span>
			<span class="n">parsefunc</span> <span class="o">=</span> <span class="n">ligolwtypes</span><span class="o">.</span><span class="n">ToPyType</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">type</span><span class="p">]</span>
		<span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
			<span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;invalid type &#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">type</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">parsefunc</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>

	<span class="nd">@pyvalue</span><span class="o">.</span><span class="n">setter</span>
	<span class="k">def</span> <span class="nf">pyvalue</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
		<span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="kc">None</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="k">try</span><span class="p">:</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="n">ligolwtypes</span><span class="o">.</span><span class="n">FromPyType</span><span class="p">[</span><span class="nb">type</span><span class="p">(</span><span class="n">value</span><span class="p">)]</span>
			<span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
				<span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;type not supported: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="nb">repr</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">value</span><span class="p">)))</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">value</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">type</span> <span class="ow">in</span> <span class="n">ligolwtypes</span><span class="o">.</span><span class="n">StringTypes</span> <span class="k">else</span> <span class="n">ligolwtypes</span><span class="o">.</span><span class="n">FormatFunc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">type</span><span class="p">](</span><span class="n">value</span><span class="p">)</span>


<span class="n">ProcessParamsTable</span><span class="o">.</span><span class="n">RowType</span> <span class="o">=</span> <span class="n">ProcessParams</span>


<span class="c1">#</span>
<span class="c1"># =============================================================================</span>
<span class="c1">#</span>
<span class="c1">#                             search_summary:table</span>
<span class="c1">#</span>
<span class="c1"># =============================================================================</span>
<span class="c1">#</span>


<span class="k">class</span> <span class="nc">SearchSummaryTable</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">Table</span><span class="p">):</span>
	<span class="n">tableName</span> <span class="o">=</span> <span class="s2">&quot;search_summary&quot;</span>
	<span class="n">validcolumns</span> <span class="o">=</span> <span class="p">{</span>
		<span class="s2">&quot;process:process_id&quot;</span><span class="p">:</span> <span class="s2">&quot;int_8s&quot;</span><span class="p">,</span>
		<span class="s2">&quot;shared_object&quot;</span><span class="p">:</span> <span class="s2">&quot;lstring&quot;</span><span class="p">,</span>
		<span class="s2">&quot;lalwrapper_cvs_tag&quot;</span><span class="p">:</span> <span class="s2">&quot;lstring&quot;</span><span class="p">,</span>
		<span class="s2">&quot;lal_cvs_tag&quot;</span><span class="p">:</span> <span class="s2">&quot;lstring&quot;</span><span class="p">,</span>
		<span class="s2">&quot;comment&quot;</span><span class="p">:</span> <span class="s2">&quot;lstring&quot;</span><span class="p">,</span>
		<span class="s2">&quot;ifos&quot;</span><span class="p">:</span> <span class="s2">&quot;lstring&quot;</span><span class="p">,</span>
		<span class="s2">&quot;in_start_time&quot;</span><span class="p">:</span> <span class="s2">&quot;int_4s&quot;</span><span class="p">,</span>
		<span class="s2">&quot;in_start_time_ns&quot;</span><span class="p">:</span> <span class="s2">&quot;int_4s&quot;</span><span class="p">,</span>
		<span class="s2">&quot;in_end_time&quot;</span><span class="p">:</span> <span class="s2">&quot;int_4s&quot;</span><span class="p">,</span>
		<span class="s2">&quot;in_end_time_ns&quot;</span><span class="p">:</span> <span class="s2">&quot;int_4s&quot;</span><span class="p">,</span>
		<span class="s2">&quot;out_start_time&quot;</span><span class="p">:</span> <span class="s2">&quot;int_4s&quot;</span><span class="p">,</span>
		<span class="s2">&quot;out_start_time_ns&quot;</span><span class="p">:</span> <span class="s2">&quot;int_4s&quot;</span><span class="p">,</span>
		<span class="s2">&quot;out_end_time&quot;</span><span class="p">:</span> <span class="s2">&quot;int_4s&quot;</span><span class="p">,</span>
		<span class="s2">&quot;out_end_time_ns&quot;</span><span class="p">:</span> <span class="s2">&quot;int_4s&quot;</span><span class="p">,</span>
		<span class="s2">&quot;nevents&quot;</span><span class="p">:</span> <span class="s2">&quot;int_4s&quot;</span><span class="p">,</span>
		<span class="s2">&quot;nnodes&quot;</span><span class="p">:</span> <span class="s2">&quot;int_4s&quot;</span>
	<span class="p">}</span>
	<span class="n">how_to_index</span> <span class="o">=</span> <span class="p">{</span>
		<span class="s2">&quot;ss_pi_index&quot;</span><span class="p">:</span> <span class="p">(</span><span class="s2">&quot;process_id&quot;</span><span class="p">,),</span>
	<span class="p">}</span>

	<span class="k">def</span> <span class="nf">get_in_segmentlistdict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">process_ids</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Return a segmentlistdict mapping instrument to in segment</span>
<span class="sd">		list.  If process_ids is a sequence of process IDs, then</span>
<span class="sd">		only rows with matching IDs are included otherwise all rows</span>
<span class="sd">		are included.</span>

<span class="sd">		Note:  the result is not coalesced, each segmentlist</span>
<span class="sd">		contains the segments listed for that instrument as they</span>
<span class="sd">		appeared in the table.</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="n">seglists</span> <span class="o">=</span> <span class="n">segments</span><span class="o">.</span><span class="n">segmentlistdict</span><span class="p">()</span>
		<span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
			<span class="n">ifos</span> <span class="o">=</span> <span class="n">row</span><span class="o">.</span><span class="n">instruments</span> <span class="ow">or</span> <span class="p">(</span><span class="kc">None</span><span class="p">,)</span>
			<span class="k">if</span> <span class="n">process_ids</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">row</span><span class="o">.</span><span class="n">process_id</span> <span class="ow">in</span> <span class="n">process_ids</span><span class="p">:</span>
				<span class="n">seglists</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="nb">dict</span><span class="p">((</span><span class="n">ifo</span><span class="p">,</span> <span class="n">segments</span><span class="o">.</span><span class="n">segmentlist</span><span class="p">([</span><span class="n">row</span><span class="o">.</span><span class="n">in_segment</span><span class="p">]))</span> <span class="k">for</span> <span class="n">ifo</span> <span class="ow">in</span> <span class="n">ifos</span><span class="p">))</span>
		<span class="k">return</span> <span class="n">seglists</span>

	<span class="k">def</span> <span class="nf">get_out_segmentlistdict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">process_ids</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Return a segmentlistdict mapping instrument to out segment</span>
<span class="sd">		list.  If process_ids is a sequence of process IDs, then</span>
<span class="sd">		only rows with matching IDs are included otherwise all rows</span>
<span class="sd">		are included.</span>

<span class="sd">		Note:  the result is not coalesced, each segmentlist</span>
<span class="sd">		contains the segments listed for that instrument as they</span>
<span class="sd">		appeared in the table.</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="n">seglists</span> <span class="o">=</span> <span class="n">segments</span><span class="o">.</span><span class="n">segmentlistdict</span><span class="p">()</span>
		<span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
			<span class="n">ifos</span> <span class="o">=</span> <span class="n">row</span><span class="o">.</span><span class="n">instruments</span> <span class="ow">or</span> <span class="p">(</span><span class="kc">None</span><span class="p">,)</span>
			<span class="k">if</span> <span class="n">process_ids</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">row</span><span class="o">.</span><span class="n">process_id</span> <span class="ow">in</span> <span class="n">process_ids</span><span class="p">:</span>
				<span class="n">seglists</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="nb">dict</span><span class="p">((</span><span class="n">ifo</span><span class="p">,</span> <span class="n">segments</span><span class="o">.</span><span class="n">segmentlist</span><span class="p">([</span><span class="n">row</span><span class="o">.</span><span class="n">out_segment</span><span class="p">]))</span> <span class="k">for</span> <span class="n">ifo</span> <span class="ow">in</span> <span class="n">ifos</span><span class="p">))</span>
		<span class="k">return</span> <span class="n">seglists</span>


<span class="k">class</span> <span class="nc">SearchSummary</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">Table</span><span class="o">.</span><span class="n">RowType</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">	Example:</span>

<span class="sd">	&gt;&gt;&gt; x = SearchSummary()</span>
<span class="sd">	&gt;&gt;&gt; x.instruments = (u&quot;H1&quot;, u&quot;L1&quot;)</span>
<span class="sd">	&gt;&gt;&gt; print(x.ifos)</span>
<span class="sd">	H1,L1</span>
<span class="sd">	&gt;&gt;&gt; assert x.instruments == set([u&#39;H1&#39;, u&#39;L1&#39;])</span>
<span class="sd">	&gt;&gt;&gt; x.in_start = x.out_start = LIGOTimeGPS(0)</span>
<span class="sd">	&gt;&gt;&gt; x.in_end = x.out_end = LIGOTimeGPS(10)</span>
<span class="sd">	&gt;&gt;&gt; x.in_segment</span>
<span class="sd">	segment(LIGOTimeGPS(0, 0), LIGOTimeGPS(10, 0))</span>
<span class="sd">	&gt;&gt;&gt; x.out_segment</span>
<span class="sd">	segment(LIGOTimeGPS(0, 0), LIGOTimeGPS(10, 0))</span>
<span class="sd">	&gt;&gt;&gt; x.in_segment = x.out_segment = None</span>
<span class="sd">	&gt;&gt;&gt; print(x.in_segment)</span>
<span class="sd">	None</span>
<span class="sd">	&gt;&gt;&gt; print(x.out_segment)</span>
<span class="sd">	None</span>
<span class="sd">	&quot;&quot;&quot;</span>
	<span class="vm">__slots__</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">Column</span><span class="o">.</span><span class="n">ColumnName</span><span class="p">,</span> <span class="n">SearchSummaryTable</span><span class="o">.</span><span class="n">validcolumns</span><span class="p">))</span>

	<span class="n">instruments</span> <span class="o">=</span> <span class="n">instrumentsproperty</span><span class="p">(</span><span class="s2">&quot;ifos&quot;</span><span class="p">)</span>

	<span class="n">in_start</span> <span class="o">=</span> <span class="n">gpsproperty</span><span class="p">(</span><span class="s2">&quot;in_start_time&quot;</span><span class="p">,</span> <span class="s2">&quot;in_start_time_ns&quot;</span><span class="p">)</span>
	<span class="n">in_end</span> <span class="o">=</span> <span class="n">gpsproperty</span><span class="p">(</span><span class="s2">&quot;in_end_time&quot;</span><span class="p">,</span> <span class="s2">&quot;in_end_time_ns&quot;</span><span class="p">)</span>
	<span class="n">out_start</span> <span class="o">=</span> <span class="n">gpsproperty</span><span class="p">(</span><span class="s2">&quot;out_start_time&quot;</span><span class="p">,</span> <span class="s2">&quot;out_start_time_ns&quot;</span><span class="p">)</span>
	<span class="n">out_end</span> <span class="o">=</span> <span class="n">gpsproperty</span><span class="p">(</span><span class="s2">&quot;out_end_time&quot;</span><span class="p">,</span> <span class="s2">&quot;out_end_time_ns&quot;</span><span class="p">)</span>

	<span class="n">in_segment</span> <span class="o">=</span> <span class="n">segmentproperty</span><span class="p">(</span><span class="s2">&quot;in_start&quot;</span><span class="p">,</span> <span class="s2">&quot;in_end&quot;</span><span class="p">)</span>
	<span class="n">out_segment</span> <span class="o">=</span> <span class="n">segmentproperty</span><span class="p">(</span><span class="s2">&quot;out_start&quot;</span><span class="p">,</span> <span class="s2">&quot;out_end&quot;</span><span class="p">)</span>

	<span class="nd">@classmethod</span>
	<span class="k">def</span> <span class="nf">initialized</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">process</span><span class="p">,</span> <span class="n">shared_object</span> <span class="o">=</span> <span class="s2">&quot;standalone&quot;</span><span class="p">,</span> <span class="n">lalwrapper_cvs_tag</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">lal_cvs_tag</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">comment</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">ifos</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">inseg</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">outseg</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">nevents</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">nnodes</span> <span class="o">=</span> <span class="mi">1</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Create and return a sensibly initialized row for the</span>
<span class="sd">		search_summary table.  process is an initialized row for</span>
<span class="sd">		the process table.</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="k">return</span> <span class="bp">cls</span><span class="p">(</span>
			<span class="n">process_id</span> <span class="o">=</span> <span class="n">process</span><span class="o">.</span><span class="n">process_id</span><span class="p">,</span>
			<span class="n">shared_object</span> <span class="o">=</span> <span class="n">shared_object</span><span class="p">,</span>
			<span class="n">lalwrapper_cvs_tag</span> <span class="o">=</span> <span class="n">lalwrapper_cvs_tag</span><span class="p">,</span>
			<span class="n">lal_cvs_tag</span> <span class="o">=</span> <span class="n">lal_cvs_tag</span><span class="p">,</span>
			<span class="n">comment</span> <span class="o">=</span> <span class="n">comment</span> <span class="ow">or</span> <span class="n">process</span><span class="o">.</span><span class="n">comment</span><span class="p">,</span>
			<span class="n">instruments</span> <span class="o">=</span> <span class="n">ifos</span> <span class="k">if</span> <span class="n">ifos</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">process</span><span class="o">.</span><span class="n">instruments</span><span class="p">,</span>
			<span class="n">in_segment</span> <span class="o">=</span> <span class="n">inseg</span><span class="p">,</span>
			<span class="n">out_segment</span> <span class="o">=</span> <span class="n">outseg</span><span class="p">,</span>
			<span class="n">nevents</span> <span class="o">=</span> <span class="n">nevents</span><span class="p">,</span>
			<span class="n">nnodes</span> <span class="o">=</span> <span class="n">nnodes</span>
		<span class="p">)</span>


<span class="n">SearchSummaryTable</span><span class="o">.</span><span class="n">RowType</span> <span class="o">=</span> <span class="n">SearchSummary</span>


<span class="c1">#</span>
<span class="c1"># =============================================================================</span>
<span class="c1">#</span>
<span class="c1">#                            search_summvars:table</span>
<span class="c1">#</span>
<span class="c1"># =============================================================================</span>
<span class="c1">#</span>


<span class="n">SearchSummVarsID</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="n">next_id</span><span class="o">.</span><span class="n">type</span><span class="p">(</span><span class="sa">u</span><span class="s2">&quot;search_summvar_id&quot;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">SearchSummVarsTable</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">Table</span><span class="p">):</span>
	<span class="n">tableName</span> <span class="o">=</span> <span class="s2">&quot;search_summvars&quot;</span>
	<span class="n">validcolumns</span> <span class="o">=</span> <span class="p">{</span>
		<span class="s2">&quot;process:process_id&quot;</span><span class="p">:</span> <span class="s2">&quot;int_8s&quot;</span><span class="p">,</span>
		<span class="s2">&quot;search_summvar_id&quot;</span><span class="p">:</span> <span class="s2">&quot;int_8s&quot;</span><span class="p">,</span>
		<span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;lstring&quot;</span><span class="p">,</span>
		<span class="s2">&quot;string&quot;</span><span class="p">:</span> <span class="s2">&quot;lstring&quot;</span><span class="p">,</span>
		<span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="s2">&quot;real_8&quot;</span>
	<span class="p">}</span>
	<span class="n">constraints</span> <span class="o">=</span> <span class="s2">&quot;PRIMARY KEY (search_summvar_id)&quot;</span>
	<span class="n">next_id</span> <span class="o">=</span> <span class="n">SearchSummVarsID</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">SearchSummVars</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">Table</span><span class="o">.</span><span class="n">RowType</span><span class="p">):</span>
	<span class="vm">__slots__</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">Column</span><span class="o">.</span><span class="n">ColumnName</span><span class="p">,</span> <span class="n">SearchSummVarsTable</span><span class="o">.</span><span class="n">validcolumns</span><span class="p">))</span>


<span class="n">SearchSummVarsTable</span><span class="o">.</span><span class="n">RowType</span> <span class="o">=</span> <span class="n">SearchSummVars</span>


<span class="c1">#</span>
<span class="c1"># =============================================================================</span>
<span class="c1">#</span>
<span class="c1">#                               sngl_burst:table</span>
<span class="c1">#</span>
<span class="c1"># =============================================================================</span>
<span class="c1">#</span>


<span class="n">SnglBurstID</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="n">next_id</span><span class="o">.</span><span class="n">type</span><span class="p">(</span><span class="sa">u</span><span class="s2">&quot;event_id&quot;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">SnglBurstTable</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">Table</span><span class="p">):</span>
	<span class="n">tableName</span> <span class="o">=</span> <span class="s2">&quot;sngl_burst&quot;</span>
	<span class="n">validcolumns</span> <span class="o">=</span> <span class="p">{</span>
		<span class="s2">&quot;creator_db&quot;</span><span class="p">:</span> <span class="s2">&quot;int_4s&quot;</span><span class="p">,</span>
		<span class="s2">&quot;process:process_id&quot;</span><span class="p">:</span> <span class="s2">&quot;int_8s&quot;</span><span class="p">,</span>
		<span class="s2">&quot;filter:filter_id&quot;</span><span class="p">:</span> <span class="s2">&quot;int_8s&quot;</span><span class="p">,</span>
		<span class="s2">&quot;ifo&quot;</span><span class="p">:</span> <span class="s2">&quot;lstring&quot;</span><span class="p">,</span>
		<span class="s2">&quot;search&quot;</span><span class="p">:</span> <span class="s2">&quot;lstring&quot;</span><span class="p">,</span>
		<span class="s2">&quot;channel&quot;</span><span class="p">:</span> <span class="s2">&quot;lstring&quot;</span><span class="p">,</span>
		<span class="s2">&quot;start_time&quot;</span><span class="p">:</span> <span class="s2">&quot;int_4s&quot;</span><span class="p">,</span>
		<span class="s2">&quot;start_time_ns&quot;</span><span class="p">:</span> <span class="s2">&quot;int_4s&quot;</span><span class="p">,</span>
		<span class="s2">&quot;stop_time&quot;</span><span class="p">:</span> <span class="s2">&quot;int_4s&quot;</span><span class="p">,</span>
		<span class="s2">&quot;stop_time_ns&quot;</span><span class="p">:</span> <span class="s2">&quot;int_4s&quot;</span><span class="p">,</span>
		<span class="s2">&quot;duration&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;flow&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;fhigh&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;central_freq&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;bandwidth&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;amplitude&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;snr&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;confidence&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;chisq&quot;</span><span class="p">:</span> <span class="s2">&quot;real_8&quot;</span><span class="p">,</span>
		<span class="s2">&quot;chisq_dof&quot;</span><span class="p">:</span> <span class="s2">&quot;real_8&quot;</span><span class="p">,</span>
		<span class="s2">&quot;tfvolume&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;hrss&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;time_lag&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;peak_time&quot;</span><span class="p">:</span> <span class="s2">&quot;int_4s&quot;</span><span class="p">,</span>
		<span class="s2">&quot;peak_time_ns&quot;</span><span class="p">:</span> <span class="s2">&quot;int_4s&quot;</span><span class="p">,</span>
		<span class="s2">&quot;peak_frequency&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;peak_strain&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;peak_time_error&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;peak_frequency_error&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;peak_strain_error&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;ms_start_time&quot;</span><span class="p">:</span> <span class="s2">&quot;int_4s&quot;</span><span class="p">,</span>
		<span class="s2">&quot;ms_start_time_ns&quot;</span><span class="p">:</span> <span class="s2">&quot;int_4s&quot;</span><span class="p">,</span>
		<span class="s2">&quot;ms_stop_time&quot;</span><span class="p">:</span> <span class="s2">&quot;int_4s&quot;</span><span class="p">,</span>
		<span class="s2">&quot;ms_stop_time_ns&quot;</span><span class="p">:</span> <span class="s2">&quot;int_4s&quot;</span><span class="p">,</span>
		<span class="s2">&quot;ms_duration&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;ms_flow&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;ms_fhigh&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;ms_bandwidth&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;ms_hrss&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;ms_snr&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;ms_confidence&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;param_one_name&quot;</span><span class="p">:</span> <span class="s2">&quot;lstring&quot;</span><span class="p">,</span>
		<span class="s2">&quot;param_one_value&quot;</span><span class="p">:</span> <span class="s2">&quot;real_8&quot;</span><span class="p">,</span>
		<span class="s2">&quot;param_two_name&quot;</span><span class="p">:</span> <span class="s2">&quot;lstring&quot;</span><span class="p">,</span>
		<span class="s2">&quot;param_two_value&quot;</span><span class="p">:</span> <span class="s2">&quot;real_8&quot;</span><span class="p">,</span>
		<span class="s2">&quot;param_three_name&quot;</span><span class="p">:</span> <span class="s2">&quot;lstring&quot;</span><span class="p">,</span>
		<span class="s2">&quot;param_three_value&quot;</span><span class="p">:</span> <span class="s2">&quot;real_8&quot;</span><span class="p">,</span>
		<span class="s2">&quot;event_id&quot;</span><span class="p">:</span> <span class="s2">&quot;int_8s&quot;</span>
	<span class="p">}</span>
	<span class="n">constraints</span> <span class="o">=</span> <span class="s2">&quot;PRIMARY KEY (event_id)&quot;</span>
	<span class="n">next_id</span> <span class="o">=</span> <span class="n">SnglBurstID</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">SnglBurst</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">Table</span><span class="o">.</span><span class="n">RowType</span><span class="p">):</span>
	<span class="vm">__slots__</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">Column</span><span class="o">.</span><span class="n">ColumnName</span><span class="p">,</span> <span class="n">SnglBurstTable</span><span class="o">.</span><span class="n">validcolumns</span><span class="p">))</span>

	<span class="c1">#</span>
	<span class="c1"># Tile properties</span>
	<span class="c1">#</span>

	<span class="n">start</span> <span class="o">=</span> <span class="n">gpsproperty</span><span class="p">(</span><span class="s2">&quot;start_time&quot;</span><span class="p">,</span> <span class="s2">&quot;start_time_ns&quot;</span><span class="p">)</span>
	<span class="n">stop</span> <span class="o">=</span> <span class="n">gpsproperty</span><span class="p">(</span><span class="s2">&quot;stop_time&quot;</span><span class="p">,</span> <span class="s2">&quot;stop_time_ns&quot;</span><span class="p">)</span>
	<span class="n">peak</span> <span class="o">=</span> <span class="n">gpsproperty</span><span class="p">(</span><span class="s2">&quot;peak_time&quot;</span><span class="p">,</span> <span class="s2">&quot;peak_time_ns&quot;</span><span class="p">)</span>

	<span class="nd">@property</span>
	<span class="k">def</span> <span class="nf">period</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="n">start</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">start</span>
		<span class="k">try</span><span class="p">:</span>
			<span class="n">stop</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stop</span>
		<span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
			<span class="n">stop</span> <span class="o">=</span> <span class="kc">None</span>
		<span class="c1"># special case:  use duration if stop is not recorded</span>
		<span class="k">if</span> <span class="n">start</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">stop</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">duration</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
			<span class="n">stop</span> <span class="o">=</span> <span class="n">start</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">duration</span>
		<span class="k">if</span> <span class="n">start</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">stop</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
			<span class="k">return</span> <span class="kc">None</span>
		<span class="k">return</span> <span class="n">segments</span><span class="o">.</span><span class="n">segment</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">stop</span><span class="p">)</span>

	<span class="nd">@period</span><span class="o">.</span><span class="n">setter</span>
	<span class="k">def</span> <span class="nf">period</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">seg</span><span class="p">):</span>
		<span class="k">if</span> <span class="n">seg</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">start</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stop</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">duration</span> <span class="o">=</span> <span class="kc">None</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">start</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">stop</span> <span class="o">=</span> <span class="n">seg</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">duration</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">seg</span><span class="p">))</span>

	<span class="nd">@property</span>
	<span class="k">def</span> <span class="nf">band</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">central_freq</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">bandwidth</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
			<span class="k">return</span> <span class="kc">None</span>
		<span class="k">return</span> <span class="n">segments</span><span class="o">.</span><span class="n">segment</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">central_freq</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">bandwidth</span> <span class="o">/</span> <span class="mf">2.</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">central_freq</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">bandwidth</span> <span class="o">/</span> <span class="mf">2.</span><span class="p">)</span>

	<span class="nd">@band</span><span class="o">.</span><span class="n">setter</span>
	<span class="k">def</span> <span class="nf">band</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">seg</span><span class="p">):</span>
		<span class="k">if</span> <span class="n">seg</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
			<span class="k">try</span><span class="p">:</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">flow</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fhigh</span> <span class="o">=</span> <span class="kc">None</span>
			<span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
				<span class="c1"># not in LAL C version</span>
				<span class="k">pass</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">central_freq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bandwidth</span> <span class="o">=</span> <span class="kc">None</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="k">try</span><span class="p">:</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">flow</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">fhigh</span> <span class="o">=</span> <span class="n">seg</span>
			<span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
				<span class="c1"># not in LAL C version</span>
				<span class="k">pass</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">central_freq</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">seg</span><span class="p">)</span> <span class="o">/</span> <span class="mf">2.</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">bandwidth</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">seg</span><span class="p">)</span>

	<span class="c1">#</span>
	<span class="c1"># &quot;Most significant pixel&quot; properties</span>
	<span class="c1">#</span>

	<span class="n">ms_start</span> <span class="o">=</span> <span class="n">gpsproperty</span><span class="p">(</span><span class="s2">&quot;ms_start_time&quot;</span><span class="p">,</span> <span class="s2">&quot;ms_start_time_ns&quot;</span><span class="p">)</span>
	<span class="n">ms_stop</span> <span class="o">=</span> <span class="n">gpsproperty</span><span class="p">(</span><span class="s2">&quot;ms_stop_time&quot;</span><span class="p">,</span> <span class="s2">&quot;ms_stop_time_ns&quot;</span><span class="p">)</span>
	<span class="n">ms_peak</span> <span class="o">=</span> <span class="n">gpsproperty</span><span class="p">(</span><span class="s2">&quot;ms_peak_time&quot;</span><span class="p">,</span> <span class="s2">&quot;ms_peak_time_ns&quot;</span><span class="p">)</span>

	<span class="nd">@property</span>
	<span class="k">def</span> <span class="nf">ms_period</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="n">start</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ms_start</span>
		<span class="n">stop</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ms_stop</span>
		<span class="c1"># special case:  use duration if stop is not recorded</span>
		<span class="k">if</span> <span class="n">start</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">stop</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">ms</span><span class="o">-</span><span class="n">duration</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
			<span class="n">stop</span> <span class="o">=</span> <span class="n">start</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">ms_duration</span>
		<span class="k">if</span> <span class="n">start</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">stop</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
			<span class="k">return</span> <span class="kc">None</span>
		<span class="k">return</span> <span class="n">segments</span><span class="o">.</span><span class="n">segment</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">stop</span><span class="p">)</span>

	<span class="nd">@ms_period</span><span class="o">.</span><span class="n">setter</span>
	<span class="k">def</span> <span class="nf">ms_period</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">seg</span><span class="p">):</span>
		<span class="k">if</span> <span class="n">seg</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">ms_start</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ms_stop</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ms_duration</span> <span class="o">=</span> <span class="kc">None</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">ms_start</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ms_stop</span> <span class="o">=</span> <span class="n">seg</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">ms_duration</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">seg</span><span class="p">))</span>

	<span class="nd">@property</span>
	<span class="k">def</span> <span class="nf">ms_band</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ms_flow</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">ms_bandwidth</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
			<span class="k">return</span> <span class="kc">None</span>
		<span class="k">return</span> <span class="n">segments</span><span class="o">.</span><span class="n">segment</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ms_flow</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ms_flow</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">ms_bandwidth</span><span class="p">)</span>

	<span class="nd">@ms_band</span><span class="o">.</span><span class="n">setter</span>
	<span class="k">def</span> <span class="nf">ms_band</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">seg</span><span class="p">):</span>
		<span class="k">if</span> <span class="n">seg</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">ms_bandwidth</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ms_flow</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ms_fhigh</span> <span class="o">=</span> <span class="kc">None</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">ms_flow</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ms_fhigh</span> <span class="o">=</span> <span class="n">seg</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">ms_bandwidth</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">seg</span><span class="p">)</span>


<span class="n">SnglBurstTable</span><span class="o">.</span><span class="n">RowType</span> <span class="o">=</span> <span class="n">SnglBurst</span>


<span class="c1">#</span>
<span class="c1"># =============================================================================</span>
<span class="c1">#</span>
<span class="c1">#                             sngl_inspiral:table</span>
<span class="c1">#</span>
<span class="c1"># =============================================================================</span>
<span class="c1">#</span>


<span class="n">SnglInspiralID</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="n">next_id</span><span class="o">.</span><span class="n">type</span><span class="p">(</span><span class="sa">u</span><span class="s2">&quot;event_id&quot;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">SnglInspiralTable</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">Table</span><span class="p">):</span>
	<span class="n">tableName</span> <span class="o">=</span> <span class="s2">&quot;sngl_inspiral&quot;</span>
	<span class="n">validcolumns</span> <span class="o">=</span> <span class="p">{</span>
		<span class="s2">&quot;process:process_id&quot;</span><span class="p">:</span> <span class="s2">&quot;int_8s&quot;</span><span class="p">,</span>
		<span class="s2">&quot;ifo&quot;</span><span class="p">:</span> <span class="s2">&quot;lstring&quot;</span><span class="p">,</span>
		<span class="s2">&quot;search&quot;</span><span class="p">:</span> <span class="s2">&quot;lstring&quot;</span><span class="p">,</span>
		<span class="s2">&quot;channel&quot;</span><span class="p">:</span> <span class="s2">&quot;lstring&quot;</span><span class="p">,</span>
		<span class="s2">&quot;end_time&quot;</span><span class="p">:</span> <span class="s2">&quot;int_4s&quot;</span><span class="p">,</span>
		<span class="s2">&quot;end_time_ns&quot;</span><span class="p">:</span> <span class="s2">&quot;int_4s&quot;</span><span class="p">,</span>
		<span class="s2">&quot;end_time_gmst&quot;</span><span class="p">:</span> <span class="s2">&quot;real_8&quot;</span><span class="p">,</span>
		<span class="s2">&quot;impulse_time&quot;</span><span class="p">:</span> <span class="s2">&quot;int_4s&quot;</span><span class="p">,</span>
		<span class="s2">&quot;impulse_time_ns&quot;</span><span class="p">:</span> <span class="s2">&quot;int_4s&quot;</span><span class="p">,</span>
		<span class="s2">&quot;template_duration&quot;</span><span class="p">:</span> <span class="s2">&quot;real_8&quot;</span><span class="p">,</span>
		<span class="s2">&quot;event_duration&quot;</span><span class="p">:</span> <span class="s2">&quot;real_8&quot;</span><span class="p">,</span>
		<span class="s2">&quot;amplitude&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;eff_distance&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;coa_phase&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;mass1&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;mass2&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;mchirp&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;mtotal&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;eta&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;kappa&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;chi&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;tau0&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;tau2&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;tau3&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;tau4&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;tau5&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;ttotal&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;psi0&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;psi3&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;alpha&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;alpha1&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;alpha2&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;alpha3&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;alpha4&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;alpha5&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;alpha6&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;beta&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;f_final&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;snr&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;chisq&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;chisq_dof&quot;</span><span class="p">:</span> <span class="s2">&quot;int_4s&quot;</span><span class="p">,</span>
		<span class="s2">&quot;bank_chisq&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;bank_chisq_dof&quot;</span><span class="p">:</span> <span class="s2">&quot;int_4s&quot;</span><span class="p">,</span>
		<span class="s2">&quot;cont_chisq&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;cont_chisq_dof&quot;</span><span class="p">:</span> <span class="s2">&quot;int_4s&quot;</span><span class="p">,</span>
		<span class="s2">&quot;sigmasq&quot;</span><span class="p">:</span> <span class="s2">&quot;real_8&quot;</span><span class="p">,</span>
		<span class="s2">&quot;rsqveto_duration&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;Gamma0&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;Gamma1&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;Gamma2&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;Gamma3&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;Gamma4&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;Gamma5&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;Gamma6&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;Gamma7&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;Gamma8&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;Gamma9&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;spin1x&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;spin1y&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;spin1z&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;spin2x&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;spin2y&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;spin2z&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;event_id&quot;</span><span class="p">:</span> <span class="s2">&quot;int_8s&quot;</span>
	<span class="p">}</span>
	<span class="n">constraints</span> <span class="o">=</span> <span class="s2">&quot;PRIMARY KEY (event_id)&quot;</span>
	<span class="n">next_id</span> <span class="o">=</span> <span class="n">SnglInspiralID</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">SnglInspiral</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">Table</span><span class="o">.</span><span class="n">RowType</span><span class="p">):</span>
	<span class="vm">__slots__</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">Column</span><span class="o">.</span><span class="n">ColumnName</span><span class="p">,</span> <span class="n">SnglInspiralTable</span><span class="o">.</span><span class="n">validcolumns</span><span class="p">))</span>

	<span class="nd">@staticmethod</span>
	<span class="k">def</span> <span class="nf">chirp_distance</span><span class="p">(</span><span class="n">dist</span><span class="p">,</span> <span class="n">mchirp</span><span class="p">,</span> <span class="n">ref_mass</span><span class="o">=</span><span class="mf">1.4</span><span class="p">):</span>
		<span class="k">return</span> <span class="n">dist</span> <span class="o">*</span> <span class="p">(</span><span class="mf">2.</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="mf">1.</span><span class="o">/</span><span class="mi">5</span><span class="p">)</span> <span class="o">*</span> <span class="n">ref_mass</span> <span class="o">/</span> <span class="n">mchirp</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mf">5.</span><span class="o">/</span><span class="mi">6</span><span class="p">)</span>

	<span class="c1">#</span>
	<span class="c1"># Properties</span>
	<span class="c1">#</span>

	<span class="n">end</span> <span class="o">=</span> <span class="n">gpsproperty_with_gmst</span><span class="p">(</span><span class="s2">&quot;end_time&quot;</span><span class="p">,</span> <span class="s2">&quot;end_time_ns&quot;</span><span class="p">,</span> <span class="s2">&quot;end_time_gmst&quot;</span><span class="p">)</span>

	<span class="nd">@property</span>
	<span class="k">def</span> <span class="nf">spin1</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">spin1x</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">spin1y</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">spin1z</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
			<span class="k">return</span> <span class="kc">None</span>
		<span class="k">return</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">spin1x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">spin1y</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">spin1z</span><span class="p">),</span> <span class="n">dtype</span> <span class="o">=</span> <span class="s2">&quot;double&quot;</span><span class="p">)</span>

	<span class="nd">@spin1</span><span class="o">.</span><span class="n">setter</span>
	<span class="k">def</span> <span class="nf">spin1</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">spin</span><span class="p">):</span>
		<span class="k">if</span> <span class="n">spin</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">spin1x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">spin1y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">spin1z</span> <span class="o">=</span> <span class="kc">None</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">spin1x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">spin1y</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">spin1z</span> <span class="o">=</span> <span class="n">spin</span>

	<span class="nd">@property</span>
	<span class="k">def</span> <span class="nf">spin2</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">spin2x</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">spin2y</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">spin2z</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
			<span class="k">return</span> <span class="kc">None</span>
		<span class="k">return</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">spin2x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">spin2y</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">spin2z</span><span class="p">),</span> <span class="n">dtype</span> <span class="o">=</span> <span class="s2">&quot;double&quot;</span><span class="p">)</span>

	<span class="nd">@spin2</span><span class="o">.</span><span class="n">setter</span>
	<span class="k">def</span> <span class="nf">spin2</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">spin</span><span class="p">):</span>
		<span class="k">if</span> <span class="n">spin</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">spin2x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">spin2y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">spin2z</span> <span class="o">=</span> <span class="kc">None</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">spin2x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">spin2y</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">spin2z</span> <span class="o">=</span> <span class="n">spin</span>

	<span class="c1">#</span>
	<span class="c1"># simulate tempate_id column</span>
	<span class="c1"># FIXME:  add a proper column for this</span>
	<span class="c1">#</span>

	<span class="nd">@property</span>
	<span class="k">def</span> <span class="nf">template_id</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Gamma0</span><span class="p">)</span>

	<span class="nd">@template_id</span><span class="o">.</span><span class="n">setter</span>
	<span class="k">def</span> <span class="nf">template_id</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">template_id</span><span class="p">):</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">Gamma0</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">template_id</span><span class="p">)</span>

	<span class="c1">#</span>
	<span class="c1"># Methods</span>
	<span class="c1">#</span>

	<span class="c1"># FIXME: how are two inspiral events defined to be the same?</span>
	<span class="k">def</span> <span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
		<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">ifo</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">ifo</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">end</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">end</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">mass1</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">mass1</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">mass2</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">mass2</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">spin1</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">spin1</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">spin2</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">spin2</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">search</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">search</span>


<span class="n">SnglInspiralTable</span><span class="o">.</span><span class="n">RowType</span> <span class="o">=</span> <span class="n">SnglInspiral</span>


<span class="c1">#</span>
<span class="c1"># =============================================================================</span>
<span class="c1">#</span>
<span class="c1">#                             coinc_inspiral:table</span>
<span class="c1">#</span>
<span class="c1"># =============================================================================</span>
<span class="c1">#</span>


<span class="k">class</span> <span class="nc">CoincInspiralTable</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">Table</span><span class="p">):</span>
	<span class="n">tableName</span> <span class="o">=</span> <span class="s2">&quot;coinc_inspiral&quot;</span>
	<span class="n">validcolumns</span> <span class="o">=</span> <span class="p">{</span>
		<span class="s2">&quot;coinc_event:coinc_event_id&quot;</span><span class="p">:</span> <span class="s2">&quot;int_8s&quot;</span><span class="p">,</span>
		<span class="s2">&quot;ifos&quot;</span><span class="p">:</span> <span class="s2">&quot;lstring&quot;</span><span class="p">,</span>
		<span class="s2">&quot;end_time&quot;</span><span class="p">:</span> <span class="s2">&quot;int_4s&quot;</span><span class="p">,</span>
		<span class="s2">&quot;end_time_ns&quot;</span><span class="p">:</span> <span class="s2">&quot;int_4s&quot;</span><span class="p">,</span>
		<span class="s2">&quot;mass&quot;</span><span class="p">:</span> <span class="s2">&quot;real_8&quot;</span><span class="p">,</span>
		<span class="s2">&quot;mchirp&quot;</span><span class="p">:</span> <span class="s2">&quot;real_8&quot;</span><span class="p">,</span>
		<span class="s2">&quot;minimum_duration&quot;</span><span class="p">:</span> <span class="s2">&quot;real_8&quot;</span><span class="p">,</span>
		<span class="s2">&quot;snr&quot;</span><span class="p">:</span> <span class="s2">&quot;real_8&quot;</span><span class="p">,</span>
		<span class="s2">&quot;false_alarm_rate&quot;</span><span class="p">:</span> <span class="s2">&quot;real_8&quot;</span><span class="p">,</span>
		<span class="s2">&quot;combined_far&quot;</span><span class="p">:</span> <span class="s2">&quot;real_8&quot;</span>
	<span class="p">}</span>
	<span class="c1"># FIXME:  like some other tables here, this table should have the</span>
	<span class="c1"># constraint that the coinc_event_id column is a primary key.  this</span>
	<span class="c1"># breaks ID reassignment in ligolw_sqlite, so until that is fixed</span>
	<span class="c1"># the constraint is being replaced with an index.</span>
	<span class="c1">#constraints = &quot;PRIMARY KEY (coinc_event_id)&quot;</span>
	<span class="n">how_to_index</span> <span class="o">=</span> <span class="p">{</span>
		<span class="s2">&quot;ci_cei_index&quot;</span><span class="p">:</span> <span class="p">(</span><span class="s2">&quot;coinc_event_id&quot;</span><span class="p">,)</span>
	<span class="p">}</span>


<span class="k">class</span> <span class="nc">CoincInspiral</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">Table</span><span class="o">.</span><span class="n">RowType</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">	Example:</span>

<span class="sd">	&gt;&gt;&gt; x = CoincInspiral()</span>
<span class="sd">	&gt;&gt;&gt; x.instruments = (u&quot;H1&quot;, u&quot;L1&quot;)</span>
<span class="sd">	&gt;&gt;&gt; print(x.ifos)</span>
<span class="sd">	H1,L1</span>
<span class="sd">	&gt;&gt;&gt; assert x.instruments == set([u&#39;H1&#39;, u&#39;L1&#39;])</span>
<span class="sd">	&gt;&gt;&gt; x.end = LIGOTimeGPS(10)</span>
<span class="sd">	&gt;&gt;&gt; x.end</span>
<span class="sd">	LIGOTimeGPS(10, 0)</span>
<span class="sd">	&gt;&gt;&gt; x.end = None</span>
<span class="sd">	&gt;&gt;&gt; print(x.end)</span>
<span class="sd">	None</span>
<span class="sd">	&quot;&quot;&quot;</span>
	<span class="vm">__slots__</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">Column</span><span class="o">.</span><span class="n">ColumnName</span><span class="p">,</span> <span class="n">CoincInspiralTable</span><span class="o">.</span><span class="n">validcolumns</span><span class="p">))</span>

	<span class="n">instruments</span> <span class="o">=</span> <span class="n">instrumentsproperty</span><span class="p">(</span><span class="s2">&quot;ifos&quot;</span><span class="p">)</span>

	<span class="n">end</span> <span class="o">=</span> <span class="n">gpsproperty</span><span class="p">(</span><span class="s2">&quot;end_time&quot;</span><span class="p">,</span> <span class="s2">&quot;end_time_ns&quot;</span><span class="p">)</span>


<span class="n">CoincInspiralTable</span><span class="o">.</span><span class="n">RowType</span> <span class="o">=</span> <span class="n">CoincInspiral</span>


<span class="c1">#</span>
<span class="c1"># =============================================================================</span>
<span class="c1">#</span>
<span class="c1">#                             sngl_ringdown:table</span>
<span class="c1">#</span>
<span class="c1"># =============================================================================</span>
<span class="c1">#</span>


<span class="n">SnglRingdownID</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="n">next_id</span><span class="o">.</span><span class="n">type</span><span class="p">(</span><span class="sa">u</span><span class="s2">&quot;event_id&quot;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">SnglRingdownTable</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">Table</span><span class="p">):</span>
	<span class="n">tableName</span> <span class="o">=</span> <span class="s2">&quot;sngl_ringdown&quot;</span>
	<span class="n">validcolumns</span> <span class="o">=</span> <span class="p">{</span>
		<span class="s2">&quot;process:process_id&quot;</span><span class="p">:</span> <span class="s2">&quot;int_8s&quot;</span><span class="p">,</span>
		<span class="s2">&quot;ifo&quot;</span><span class="p">:</span> <span class="s2">&quot;lstring&quot;</span><span class="p">,</span>
		<span class="s2">&quot;channel&quot;</span><span class="p">:</span> <span class="s2">&quot;lstring&quot;</span><span class="p">,</span>
		<span class="s2">&quot;start_time&quot;</span><span class="p">:</span> <span class="s2">&quot;int_4s&quot;</span><span class="p">,</span>
		<span class="s2">&quot;start_time_ns&quot;</span><span class="p">:</span> <span class="s2">&quot;int_4s&quot;</span><span class="p">,</span>
		<span class="s2">&quot;start_time_gmst&quot;</span><span class="p">:</span> <span class="s2">&quot;real_8&quot;</span><span class="p">,</span>
		<span class="s2">&quot;frequency&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;quality&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;phase&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;mass&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;spin&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;epsilon&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;num_clust_trigs&quot;</span><span class="p">:</span> <span class="s2">&quot;int_4s&quot;</span><span class="p">,</span>
		<span class="s2">&quot;ds2_H1H2&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;ds2_H1L1&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;ds2_H1V1&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;ds2_H2L1&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;ds2_H2V1&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;ds2_L1V1&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;amplitude&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;snr&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;eff_dist&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;sigma_sq&quot;</span><span class="p">:</span> <span class="s2">&quot;real_8&quot;</span><span class="p">,</span>
		<span class="s2">&quot;event_id&quot;</span><span class="p">:</span> <span class="s2">&quot;int_8s&quot;</span>
	<span class="p">}</span>
	<span class="n">constraints</span> <span class="o">=</span> <span class="s2">&quot;PRIMARY KEY (event_id)&quot;</span>
	<span class="n">next_id</span> <span class="o">=</span> <span class="n">SnglRingdownID</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">SnglRingdown</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">Table</span><span class="o">.</span><span class="n">RowType</span><span class="p">):</span>
	<span class="vm">__slots__</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">Column</span><span class="o">.</span><span class="n">ColumnName</span><span class="p">,</span> <span class="n">SnglRingdownTable</span><span class="o">.</span><span class="n">validcolumns</span><span class="p">))</span>

	<span class="n">start</span> <span class="o">=</span> <span class="n">gpsproperty_with_gmst</span><span class="p">(</span><span class="s2">&quot;start_time&quot;</span><span class="p">,</span> <span class="s2">&quot;start_time_ns&quot;</span><span class="p">,</span> <span class="s2">&quot;start_time_gmst&quot;</span><span class="p">)</span>


<span class="n">SnglRingdownTable</span><span class="o">.</span><span class="n">RowType</span> <span class="o">=</span> <span class="n">SnglRingdown</span>


<span class="c1">#</span>
<span class="c1"># =============================================================================</span>
<span class="c1">#</span>
<span class="c1">#                             coinc_ringdown:table</span>
<span class="c1">#</span>
<span class="c1"># =============================================================================</span>
<span class="c1">#</span>


<span class="k">class</span> <span class="nc">CoincRingdownTable</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">Table</span><span class="p">):</span>
	<span class="n">tableName</span> <span class="o">=</span> <span class="s2">&quot;coinc_ringdown&quot;</span>
	<span class="n">validcolumns</span> <span class="o">=</span> <span class="p">{</span>
		<span class="s2">&quot;coinc_event:coinc_event_id&quot;</span><span class="p">:</span> <span class="s2">&quot;int_8s&quot;</span><span class="p">,</span>
		<span class="s2">&quot;ifos&quot;</span><span class="p">:</span> <span class="s2">&quot;lstring&quot;</span><span class="p">,</span>
		<span class="s2">&quot;start_time&quot;</span><span class="p">:</span> <span class="s2">&quot;int_4s&quot;</span><span class="p">,</span>
		<span class="s2">&quot;start_time_ns&quot;</span><span class="p">:</span> <span class="s2">&quot;int_4s&quot;</span><span class="p">,</span>
		<span class="s2">&quot;frequency&quot;</span><span class="p">:</span> <span class="s2">&quot;real_8&quot;</span><span class="p">,</span>
		<span class="s2">&quot;quality&quot;</span><span class="p">:</span> <span class="s2">&quot;real_8&quot;</span><span class="p">,</span>
		<span class="s2">&quot;mass&quot;</span><span class="p">:</span> <span class="s2">&quot;real_8&quot;</span><span class="p">,</span>
		<span class="s2">&quot;spin&quot;</span><span class="p">:</span> <span class="s2">&quot;real_8&quot;</span><span class="p">,</span>
		<span class="s2">&quot;snr&quot;</span><span class="p">:</span> <span class="s2">&quot;real_8&quot;</span><span class="p">,</span>
		<span class="s2">&quot;choppedl_snr&quot;</span><span class="p">:</span> <span class="s2">&quot;real_8&quot;</span><span class="p">,</span>
		<span class="s2">&quot;snr_sq&quot;</span><span class="p">:</span> <span class="s2">&quot;real_8&quot;</span><span class="p">,</span>
		<span class="s2">&quot;eff_coh_snr&quot;</span><span class="p">:</span> <span class="s2">&quot;real_8&quot;</span><span class="p">,</span>
		<span class="s2">&quot;null_stat&quot;</span><span class="p">:</span> <span class="s2">&quot;real_8&quot;</span><span class="p">,</span>
		<span class="s2">&quot;kappa&quot;</span><span class="p">:</span> <span class="s2">&quot;real_8&quot;</span><span class="p">,</span>
		<span class="s2">&quot;snr_ratio&quot;</span><span class="p">:</span> <span class="s2">&quot;real_8&quot;</span><span class="p">,</span>
		<span class="s2">&quot;false_alarm_rate&quot;</span><span class="p">:</span> <span class="s2">&quot;real_8&quot;</span><span class="p">,</span>
		<span class="s2">&quot;combined_far&quot;</span><span class="p">:</span> <span class="s2">&quot;real_8&quot;</span>
	<span class="p">}</span>
	<span class="c1"># constraints = &quot;PRIMARY KEY (coinc_event_id)&quot;</span>
	<span class="n">how_to_index</span> <span class="o">=</span> <span class="p">{</span>
		<span class="s2">&quot;cr_cei_index&quot;</span><span class="p">:</span> <span class="p">(</span><span class="s2">&quot;coinc_event_id&quot;</span><span class="p">,)</span>
	<span class="p">}</span>


<span class="k">class</span> <span class="nc">CoincRingdown</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">Table</span><span class="o">.</span><span class="n">RowType</span><span class="p">):</span>
	<span class="vm">__slots__</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">Column</span><span class="o">.</span><span class="n">ColumnName</span><span class="p">,</span> <span class="n">CoincRingdownTable</span><span class="o">.</span><span class="n">validcolumns</span><span class="p">))</span>

	<span class="n">instruments</span> <span class="o">=</span> <span class="n">instrumentsproperty</span><span class="p">(</span><span class="s2">&quot;ifos&quot;</span><span class="p">)</span>

	<span class="n">start</span> <span class="o">=</span> <span class="n">gpsproperty</span><span class="p">(</span><span class="s2">&quot;start_time&quot;</span><span class="p">,</span> <span class="s2">&quot;start_time_ns&quot;</span><span class="p">)</span>


<span class="n">CoincRingdownTable</span><span class="o">.</span><span class="n">RowType</span> <span class="o">=</span> <span class="n">CoincRingdown</span>


<span class="c1">#</span>
<span class="c1"># =============================================================================</span>
<span class="c1">#</span>
<span class="c1">#                              sim_inspiral:table</span>
<span class="c1">#</span>
<span class="c1"># =============================================================================</span>
<span class="c1">#</span>


<span class="n">SimInspiralID</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="n">next_id</span><span class="o">.</span><span class="n">type</span><span class="p">(</span><span class="sa">u</span><span class="s2">&quot;simulation_id&quot;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">SimInspiralTable</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">Table</span><span class="p">):</span>
	<span class="n">tableName</span> <span class="o">=</span> <span class="s2">&quot;sim_inspiral&quot;</span>
	<span class="n">validcolumns</span> <span class="o">=</span> <span class="p">{</span>
		<span class="s2">&quot;process:process_id&quot;</span><span class="p">:</span> <span class="s2">&quot;int_8s&quot;</span><span class="p">,</span>
		<span class="s2">&quot;waveform&quot;</span><span class="p">:</span> <span class="s2">&quot;lstring&quot;</span><span class="p">,</span>
		<span class="s2">&quot;geocent_end_time&quot;</span><span class="p">:</span> <span class="s2">&quot;int_4s&quot;</span><span class="p">,</span>
		<span class="s2">&quot;geocent_end_time_ns&quot;</span><span class="p">:</span> <span class="s2">&quot;int_4s&quot;</span><span class="p">,</span>
		<span class="s2">&quot;h_end_time&quot;</span><span class="p">:</span> <span class="s2">&quot;int_4s&quot;</span><span class="p">,</span>
		<span class="s2">&quot;h_end_time_ns&quot;</span><span class="p">:</span> <span class="s2">&quot;int_4s&quot;</span><span class="p">,</span>
		<span class="s2">&quot;l_end_time&quot;</span><span class="p">:</span> <span class="s2">&quot;int_4s&quot;</span><span class="p">,</span>
		<span class="s2">&quot;l_end_time_ns&quot;</span><span class="p">:</span> <span class="s2">&quot;int_4s&quot;</span><span class="p">,</span>
		<span class="s2">&quot;g_end_time&quot;</span><span class="p">:</span> <span class="s2">&quot;int_4s&quot;</span><span class="p">,</span>
		<span class="s2">&quot;g_end_time_ns&quot;</span><span class="p">:</span> <span class="s2">&quot;int_4s&quot;</span><span class="p">,</span>
		<span class="s2">&quot;t_end_time&quot;</span><span class="p">:</span> <span class="s2">&quot;int_4s&quot;</span><span class="p">,</span>
		<span class="s2">&quot;t_end_time_ns&quot;</span><span class="p">:</span> <span class="s2">&quot;int_4s&quot;</span><span class="p">,</span>
		<span class="s2">&quot;v_end_time&quot;</span><span class="p">:</span> <span class="s2">&quot;int_4s&quot;</span><span class="p">,</span>
		<span class="s2">&quot;v_end_time_ns&quot;</span><span class="p">:</span> <span class="s2">&quot;int_4s&quot;</span><span class="p">,</span>
		<span class="s2">&quot;end_time_gmst&quot;</span><span class="p">:</span> <span class="s2">&quot;real_8&quot;</span><span class="p">,</span>
		<span class="s2">&quot;source&quot;</span><span class="p">:</span> <span class="s2">&quot;lstring&quot;</span><span class="p">,</span>
		<span class="s2">&quot;mass1&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;mass2&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;mchirp&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;eta&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;distance&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;longitude&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;latitude&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;inclination&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;coa_phase&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;polarization&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;psi0&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;psi3&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;alpha&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;alpha1&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;alpha2&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;alpha3&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;alpha4&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;alpha5&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;alpha6&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;beta&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;spin1x&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;spin1y&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;spin1z&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;spin2x&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;spin2y&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;spin2z&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;theta0&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;phi0&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;f_lower&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;f_final&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;eff_dist_h&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;eff_dist_l&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;eff_dist_g&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;eff_dist_t&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;eff_dist_v&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;numrel_mode_min&quot;</span><span class="p">:</span> <span class="s2">&quot;int_4s&quot;</span><span class="p">,</span>
		<span class="s2">&quot;numrel_mode_max&quot;</span><span class="p">:</span> <span class="s2">&quot;int_4s&quot;</span><span class="p">,</span>
		<span class="s2">&quot;numrel_data&quot;</span><span class="p">:</span> <span class="s2">&quot;lstring&quot;</span><span class="p">,</span>
		<span class="s2">&quot;amp_order&quot;</span><span class="p">:</span> <span class="s2">&quot;int_4s&quot;</span><span class="p">,</span>
		<span class="s2">&quot;taper&quot;</span><span class="p">:</span> <span class="s2">&quot;lstring&quot;</span><span class="p">,</span>
		<span class="s2">&quot;bandpass&quot;</span><span class="p">:</span> <span class="s2">&quot;int_4s&quot;</span><span class="p">,</span>
		<span class="s2">&quot;simulation_id&quot;</span><span class="p">:</span> <span class="s2">&quot;int_8s&quot;</span>
	<span class="p">}</span>
	<span class="n">constraints</span> <span class="o">=</span> <span class="s2">&quot;PRIMARY KEY (simulation_id)&quot;</span>
	<span class="n">next_id</span> <span class="o">=</span> <span class="n">SimInspiralID</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">SimInspiral</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">Table</span><span class="o">.</span><span class="n">RowType</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">	Example:</span>

<span class="sd">	&gt;&gt;&gt; x = SimInspiral()</span>
<span class="sd">	&gt;&gt;&gt; x.ra_dec = 0., 0.</span>
<span class="sd">	&gt;&gt;&gt; x.ra_dec</span>
<span class="sd">	(0.0, 0.0)</span>
<span class="sd">	&gt;&gt;&gt; x.ra_dec = None</span>
<span class="sd">	&gt;&gt;&gt; print(x.ra_dec)</span>
<span class="sd">	None</span>
<span class="sd">	&gt;&gt;&gt; x.time_geocent = None</span>
<span class="sd">	&gt;&gt;&gt; print(x.time_geocent)</span>
<span class="sd">	None</span>
<span class="sd">	&gt;&gt;&gt; print(x.end_time_gmst)</span>
<span class="sd">	None</span>
<span class="sd">	&gt;&gt;&gt; x.time_geocent = LIGOTimeGPS(6e8)</span>
<span class="sd">	&gt;&gt;&gt; print(x.time_geocent)</span>
<span class="sd">	600000000</span>
<span class="sd">	&gt;&gt;&gt; print(round(x.end_time_gmst, 8))</span>
<span class="sd">	-2238.39417156</span>
<span class="sd">	&gt;&gt;&gt; x.distance = 100e6</span>
<span class="sd">	&gt;&gt;&gt; x.ra_dec = 0., 0.</span>
<span class="sd">	&gt;&gt;&gt; x.inclination = 0.</span>
<span class="sd">	&gt;&gt;&gt; x.polarization = 0.</span>
<span class="sd">	&gt;&gt;&gt; x.snr_geometry_factors((&quot;H1&quot;,))</span>
<span class="sd">	{&#39;H1&#39;: 0.6773046071543202}</span>
<span class="sd">	&gt;&gt;&gt; x.effective_distances((&quot;H1&quot;,))</span>
<span class="sd">	{&#39;H1&#39;: 147644056.9630077}</span>
<span class="sd">	&gt;&gt;&gt; x.expected_snrs({&quot;H1&quot;: 150e6})</span>
<span class="sd">	{&#39;H1&#39;: 8.127655285851842}</span>
<span class="sd">	&quot;&quot;&quot;</span>
	<span class="vm">__slots__</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">Column</span><span class="o">.</span><span class="n">ColumnName</span><span class="p">,</span> <span class="n">SimInspiralTable</span><span class="o">.</span><span class="n">validcolumns</span><span class="p">))</span>

	<span class="n">time_geocent</span> <span class="o">=</span> <span class="n">gpsproperty_with_gmst</span><span class="p">(</span><span class="s2">&quot;geocent_end_time&quot;</span><span class="p">,</span> <span class="s2">&quot;geocent_end_time_ns&quot;</span><span class="p">,</span> <span class="s2">&quot;end_time_gmst&quot;</span><span class="p">)</span>

	<span class="nd">@property</span>
	<span class="k">def</span> <span class="nf">ra_dec</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">longitude</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">latitude</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
			<span class="k">return</span> <span class="kc">None</span>
		<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">longitude</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">latitude</span>

	<span class="nd">@ra_dec</span><span class="o">.</span><span class="n">setter</span>
	<span class="k">def</span> <span class="nf">ra_dec</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">radec</span><span class="p">):</span>
		<span class="k">if</span> <span class="n">radec</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">longitude</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">latitude</span> <span class="o">=</span> <span class="kc">None</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">longitude</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">latitude</span> <span class="o">=</span> <span class="n">radec</span>

	<span class="nd">@property</span>
	<span class="k">def</span> <span class="nf">spin1</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">spin1x</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">spin1y</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">spin1z</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
			<span class="k">return</span> <span class="kc">None</span>
		<span class="k">return</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">spin1x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">spin1y</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">spin1z</span><span class="p">),</span> <span class="n">dtype</span> <span class="o">=</span> <span class="s2">&quot;double&quot;</span><span class="p">)</span>

	<span class="nd">@spin1</span><span class="o">.</span><span class="n">setter</span>
	<span class="k">def</span> <span class="nf">spin1</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">spin</span><span class="p">):</span>
		<span class="k">if</span> <span class="n">spin</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">spin1x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">spin1y</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">spin1z</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">spin1x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">spin1y</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">spin1z</span> <span class="o">=</span> <span class="n">spin</span>

	<span class="nd">@property</span>
	<span class="k">def</span> <span class="nf">spin2</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">spin2x</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">spin2y</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">spin2z</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
			<span class="k">return</span> <span class="kc">None</span>
		<span class="k">return</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">spin2x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">spin2y</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">spin2z</span><span class="p">),</span> <span class="n">dtype</span> <span class="o">=</span> <span class="s2">&quot;double&quot;</span><span class="p">)</span>

	<span class="nd">@spin2</span><span class="o">.</span><span class="n">setter</span>
	<span class="k">def</span> <span class="nf">spin2</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">spin</span><span class="p">):</span>
		<span class="k">if</span> <span class="n">spin</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">spin2x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">spin2y</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">spin2z</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">spin2x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">spin2y</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">spin2z</span> <span class="o">=</span> <span class="n">spin</span>

	<span class="k">def</span> <span class="nf">time_at_instrument</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">instrument</span><span class="p">,</span> <span class="n">offsetvector</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Return the &quot;time&quot; of the injection, delay corrected for the</span>
<span class="sd">		displacement from the geocentre to the given instrument.</span>

<span class="sd">		NOTE:  this method does not account for the rotation of the</span>
<span class="sd">		Earth that occurs during the transit of the plane wave from</span>
<span class="sd">		the detector to the geocentre.  That is, it is assumed the</span>
<span class="sd">		Earth is in the same orientation with respect to the</span>
<span class="sd">		celestial sphere when the wave passes through the detector</span>
<span class="sd">		as when it passes through the geocentre.  The Earth rotates</span>
<span class="sd">		by about 1.5 urad during the 21 ms it takes light to travel</span>
<span class="sd">		the radius of the Earth, which corresponds to 10 m of</span>
<span class="sd">		displacement at the equator, or 33 light-ns.  Therefore,</span>
<span class="sd">		the failure to do a proper retarded time calculation here</span>
<span class="sd">		results in errors as large as 33 ns.  This is insignificant</span>
<span class="sd">		in present applications, but be aware that this</span>
<span class="sd">		approximation is being made if the return value is used in</span>
<span class="sd">		other contexts.</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="c1"># the offset is subtracted from the time of the injection.</span>
		<span class="c1"># injections are done this way so that when the triggers</span>
		<span class="c1"># that result from an injection have the offset vector</span>
		<span class="c1"># added to their times the triggers will form a coinc</span>
		<span class="n">t_geocent</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">time_geocent</span> <span class="o">-</span> <span class="n">offsetvector</span><span class="p">[</span><span class="n">instrument</span><span class="p">]</span>
		<span class="n">ra</span><span class="p">,</span> <span class="n">dec</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ra_dec</span>
		<span class="k">return</span> <span class="n">t_geocent</span> <span class="o">+</span> <span class="n">lal</span><span class="o">.</span><span class="n">TimeDelayFromEarthCenter</span><span class="p">(</span><span class="n">lal</span><span class="o">.</span><span class="n">cached_detector_by_prefix</span><span class="p">[</span><span class="n">instrument</span><span class="p">]</span><span class="o">.</span><span class="n">location</span><span class="p">,</span> <span class="n">ra</span><span class="p">,</span> <span class="n">dec</span><span class="p">,</span> <span class="n">t_geocent</span><span class="p">)</span>

	<span class="k">def</span> <span class="nf">snr_geometry_factors</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">instruments</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Compute and return a dictionary of the ratios of the</span>
<span class="sd">		source&#39;s physical distance to its effective distances for</span>
<span class="sd">		each of the given instruments.  The expected SNR in a</span>
<span class="sd">		detector is</span>

<span class="sd">		rho_{0} = 8 * (D_horizon / D) * snr_geometry_factor,</span>

<span class="sd">		where D_horizon is the detector&#39;s horizon distance for this</span>
<span class="sd">		waveform (computed from the detector&#39;s noise spectral</span>
<span class="sd">		density), and D is the source&#39;s physical distance.  The</span>
<span class="sd">		geometry factor (what this method computes) depends on the</span>
<span class="sd">		direction to the source with respect to the antenna beam,</span>
<span class="sd">		the inclination of the source&#39;s orbital plane, and the wave</span>
<span class="sd">		frame&#39;s polarization.  The combination (D / geometry</span>
<span class="sd">		factor) is called the effective distance.  See Equation</span>
<span class="sd">		(4.3) of arXiv:0705.1514.</span>

<span class="sd">		See also .effective_distances(), .expected_snrs().</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="n">cos2i</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">inclination</span><span class="p">)</span><span class="o">**</span><span class="mf">2.</span>
		<span class="c1"># don&#39;t rely on self.gmst to be set properly</span>
		<span class="n">gmst</span> <span class="o">=</span> <span class="n">lal</span><span class="o">.</span><span class="n">GreenwichMeanSiderealTime</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">time_geocent</span><span class="p">)</span>
		<span class="n">snr_geometry_factors</span> <span class="o">=</span> <span class="p">{}</span>
		<span class="k">for</span> <span class="n">instrument</span> <span class="ow">in</span> <span class="n">instruments</span><span class="p">:</span>
			<span class="n">fp</span><span class="p">,</span> <span class="n">fc</span> <span class="o">=</span> <span class="n">lal</span><span class="o">.</span><span class="n">ComputeDetAMResponse</span><span class="p">(</span>
				<span class="n">lal</span><span class="o">.</span><span class="n">cached_detector_by_prefix</span><span class="p">[</span><span class="n">instrument</span><span class="p">]</span><span class="o">.</span><span class="n">response</span><span class="p">,</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">longitude</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">latitude</span><span class="p">,</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">polarization</span><span class="p">,</span>
				<span class="n">gmst</span>
			<span class="p">)</span>
			<span class="n">snr_geometry_factors</span><span class="p">[</span><span class="n">instrument</span><span class="p">]</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">fp</span><span class="o">**</span><span class="mf">2.</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.</span> <span class="o">+</span> <span class="n">cos2i</span><span class="p">)</span><span class="o">**</span><span class="mf">2.</span> <span class="o">/</span> <span class="mf">4.</span> <span class="o">+</span> <span class="n">fc</span><span class="o">**</span><span class="mf">2.</span> <span class="o">*</span> <span class="n">cos2i</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">snr_geometry_factors</span>

	<span class="k">def</span> <span class="nf">effective_distances</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">instruments</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Compute and return a dictionary of the effective distances</span>
<span class="sd">		for this injection for the given instruments.  The expected</span>
<span class="sd">		SNR in a detector is</span>

<span class="sd">		rho_{0} = 8 * D_horizon / D_effective</span>

<span class="sd">		where D_effective, the effective distance, is related to</span>
<span class="sd">		the physical distance, D, by geometry factors</span>

<span class="sd">		D_effective = D / (geometry factors).</span>

<span class="sd">		See also .snr_geometry_factors(), .expected_snrs().</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="k">return</span> <span class="p">{</span><span class="n">instrument</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">distance</span> <span class="o">/</span> <span class="n">snr_geometry_factor</span> <span class="k">for</span> <span class="n">instrument</span><span class="p">,</span> <span class="n">snr_geometry_factor</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">snr_geometry_factors</span><span class="p">(</span><span class="n">instruments</span><span class="p">)</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>

	<span class="k">def</span> <span class="nf">expected_snrs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">horizon_distances</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Compute and return a dictionary of the expected SNRs for</span>
<span class="sd">		this injection in the given instruments.  horizon_distances</span>
<span class="sd">		is a dictionary giving the horizon distance for each of the</span>
<span class="sd">		detectors for which an expected SNR is to be computed.  The</span>
<span class="sd">		expected SNR in a detector is</span>

<span class="sd">		rho_{0} = 8 * D_horizon / D_effective.</span>

<span class="sd">		See also .effective_distances().</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="k">return</span> <span class="p">{</span><span class="n">instrument</span><span class="p">:</span> <span class="mf">8.</span> <span class="o">*</span> <span class="n">horizon_distances</span><span class="p">[</span><span class="n">instrument</span><span class="p">]</span> <span class="o">/</span> <span class="n">effective_distance</span> <span class="k">for</span> <span class="n">instrument</span><span class="p">,</span> <span class="n">effective_distance</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">effective_distances</span><span class="p">(</span><span class="n">horizon_distances</span><span class="p">)</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>


<span class="n">SimInspiralTable</span><span class="o">.</span><span class="n">RowType</span> <span class="o">=</span> <span class="n">SimInspiral</span>


<span class="c1">#</span>
<span class="c1"># =============================================================================</span>
<span class="c1">#</span>
<span class="c1">#                               sim_burst:table</span>
<span class="c1">#</span>
<span class="c1"># =============================================================================</span>
<span class="c1">#</span>


<span class="n">SimBurstID</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="n">next_id</span><span class="o">.</span><span class="n">type</span><span class="p">(</span><span class="sa">u</span><span class="s2">&quot;simulation_id&quot;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">SimBurstTable</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">Table</span><span class="p">):</span>
	<span class="n">tableName</span> <span class="o">=</span> <span class="s2">&quot;sim_burst&quot;</span>
	<span class="n">validcolumns</span> <span class="o">=</span> <span class="p">{</span>
		<span class="s2">&quot;process:process_id&quot;</span><span class="p">:</span> <span class="s2">&quot;int_8s&quot;</span><span class="p">,</span>
		<span class="s2">&quot;waveform&quot;</span><span class="p">:</span> <span class="s2">&quot;lstring&quot;</span><span class="p">,</span>
		<span class="s2">&quot;ra&quot;</span><span class="p">:</span> <span class="s2">&quot;real_8&quot;</span><span class="p">,</span>
		<span class="s2">&quot;dec&quot;</span><span class="p">:</span> <span class="s2">&quot;real_8&quot;</span><span class="p">,</span>
		<span class="s2">&quot;psi&quot;</span><span class="p">:</span> <span class="s2">&quot;real_8&quot;</span><span class="p">,</span>
		<span class="s2">&quot;time_geocent_gps&quot;</span><span class="p">:</span> <span class="s2">&quot;int_4s&quot;</span><span class="p">,</span>
		<span class="s2">&quot;time_geocent_gps_ns&quot;</span><span class="p">:</span> <span class="s2">&quot;int_4s&quot;</span><span class="p">,</span>
		<span class="s2">&quot;time_geocent_gmst&quot;</span><span class="p">:</span> <span class="s2">&quot;real_8&quot;</span><span class="p">,</span>
		<span class="s2">&quot;duration&quot;</span><span class="p">:</span> <span class="s2">&quot;real_8&quot;</span><span class="p">,</span>
		<span class="s2">&quot;frequency&quot;</span><span class="p">:</span> <span class="s2">&quot;real_8&quot;</span><span class="p">,</span>
		<span class="s2">&quot;bandwidth&quot;</span><span class="p">:</span> <span class="s2">&quot;real_8&quot;</span><span class="p">,</span>
		<span class="s2">&quot;q&quot;</span><span class="p">:</span> <span class="s2">&quot;real_8&quot;</span><span class="p">,</span>
		<span class="s2">&quot;pol_ellipse_angle&quot;</span><span class="p">:</span> <span class="s2">&quot;real_8&quot;</span><span class="p">,</span>
		<span class="s2">&quot;pol_ellipse_e&quot;</span><span class="p">:</span> <span class="s2">&quot;real_8&quot;</span><span class="p">,</span>
		<span class="s2">&quot;amplitude&quot;</span><span class="p">:</span> <span class="s2">&quot;real_8&quot;</span><span class="p">,</span>
		<span class="s2">&quot;hrss&quot;</span><span class="p">:</span> <span class="s2">&quot;real_8&quot;</span><span class="p">,</span>
		<span class="s2">&quot;egw_over_rsquared&quot;</span><span class="p">:</span> <span class="s2">&quot;real_8&quot;</span><span class="p">,</span>
		<span class="s2">&quot;waveform_number&quot;</span><span class="p">:</span> <span class="s2">&quot;int_8u&quot;</span><span class="p">,</span>
		<span class="s2">&quot;time_slide:time_slide_id&quot;</span><span class="p">:</span> <span class="s2">&quot;int_8s&quot;</span><span class="p">,</span>
		<span class="s2">&quot;simulation_id&quot;</span><span class="p">:</span> <span class="s2">&quot;int_8s&quot;</span>
	<span class="p">}</span>
	<span class="n">constraints</span> <span class="o">=</span> <span class="s2">&quot;PRIMARY KEY (simulation_id)&quot;</span>
	<span class="n">next_id</span> <span class="o">=</span> <span class="n">SimBurstID</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">SimBurst</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">Table</span><span class="o">.</span><span class="n">RowType</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">	Example:</span>

<span class="sd">	&gt;&gt;&gt; x = SimBurst()</span>
<span class="sd">	&gt;&gt;&gt; x.ra_dec = 0., 0.</span>
<span class="sd">	&gt;&gt;&gt; x.ra_dec</span>
<span class="sd">	(0.0, 0.0)</span>
<span class="sd">	&gt;&gt;&gt; x.ra_dec = None</span>
<span class="sd">	&gt;&gt;&gt; print(x.ra_dec)</span>
<span class="sd">	None</span>
<span class="sd">	&gt;&gt;&gt; x.time_geocent = None</span>
<span class="sd">	&gt;&gt;&gt; print(x.time_geocent)</span>
<span class="sd">	None</span>
<span class="sd">	&gt;&gt;&gt; print(x.time_geocent_gmst)</span>
<span class="sd">	None</span>
<span class="sd">	&gt;&gt;&gt; x.time_geocent = LIGOTimeGPS(6e8)</span>
<span class="sd">	&gt;&gt;&gt; print(x.time_geocent)</span>
<span class="sd">	600000000</span>
<span class="sd">	&gt;&gt;&gt; print(round(x.time_geocent_gmst, 8))</span>
<span class="sd">	-2238.39417156</span>
<span class="sd">	&quot;&quot;&quot;</span>
	<span class="vm">__slots__</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">Column</span><span class="o">.</span><span class="n">ColumnName</span><span class="p">,</span> <span class="n">SimBurstTable</span><span class="o">.</span><span class="n">validcolumns</span><span class="p">))</span>

	<span class="n">time_geocent</span> <span class="o">=</span> <span class="n">gpsproperty_with_gmst</span><span class="p">(</span><span class="s2">&quot;time_geocent_gps&quot;</span><span class="p">,</span> <span class="s2">&quot;time_geocent_gps_ns&quot;</span><span class="p">,</span> <span class="s2">&quot;time_geocent_gmst&quot;</span><span class="p">)</span>

	<span class="nd">@property</span>
	<span class="k">def</span> <span class="nf">ra_dec</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ra</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">dec</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
			<span class="k">return</span> <span class="kc">None</span>
		<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">ra</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dec</span>

	<span class="nd">@ra_dec</span><span class="o">.</span><span class="n">setter</span>
	<span class="k">def</span> <span class="nf">ra_dec</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">radec</span><span class="p">):</span>
		<span class="k">if</span> <span class="n">radec</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">ra</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dec</span> <span class="o">=</span> <span class="kc">None</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">ra</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dec</span> <span class="o">=</span> <span class="n">radec</span>

	<span class="k">def</span> <span class="nf">time_at_instrument</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">instrument</span><span class="p">,</span> <span class="n">offsetvector</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Return the &quot;time&quot; of the injection, delay corrected for the</span>
<span class="sd">		displacement from the geocentre to the given instrument.</span>

<span class="sd">		NOTE:  this method does not account for the rotation of the</span>
<span class="sd">		Earth that occurs during the transit of the plane wave from</span>
<span class="sd">		the detector to the geocentre.  That is, it is assumed the</span>
<span class="sd">		Earth is in the same orientation with respect to the</span>
<span class="sd">		celestial sphere when the wave passes through the detector</span>
<span class="sd">		as when it passes through the geocentre.  The Earth rotates</span>
<span class="sd">		by about 1.5 urad during the 21 ms it takes light to travel</span>
<span class="sd">		the radius of the Earth, which corresponds to 10 m of</span>
<span class="sd">		displacement at the equator, or 33 light-ns.  Therefore,</span>
<span class="sd">		the failure to do a proper retarded time calculation here</span>
<span class="sd">		results in errors as large as 33 ns.  This is insignificant</span>
<span class="sd">		for burst searches, but be aware that this approximation is</span>
<span class="sd">		being made if the return value is used in other contexts.</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="c1"># the offset is subtracted from the time of the injection.</span>
		<span class="c1"># injections are done this way so that when the triggers</span>
		<span class="c1"># that result from an injection have the offset vector</span>
		<span class="c1"># added to their times the triggers will form a coinc</span>
		<span class="n">t_geocent</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">time_geocent</span> <span class="o">-</span> <span class="n">offsetvector</span><span class="p">[</span><span class="n">instrument</span><span class="p">]</span>
		<span class="n">ra</span><span class="p">,</span> <span class="n">dec</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ra_dec</span>
		<span class="k">return</span> <span class="n">t_geocent</span> <span class="o">+</span> <span class="n">lal</span><span class="o">.</span><span class="n">TimeDelayFromEarthCenter</span><span class="p">(</span><span class="n">lal</span><span class="o">.</span><span class="n">cached_detector_by_prefix</span><span class="p">[</span><span class="n">instrument</span><span class="p">]</span><span class="o">.</span><span class="n">location</span><span class="p">,</span> <span class="n">ra</span><span class="p">,</span> <span class="n">dec</span><span class="p">,</span> <span class="n">t_geocent</span><span class="p">)</span>


<span class="n">SimBurstTable</span><span class="o">.</span><span class="n">RowType</span> <span class="o">=</span> <span class="n">SimBurst</span>


<span class="c1">#</span>
<span class="c1"># =============================================================================</span>
<span class="c1">#</span>
<span class="c1">#                              sim_ringdown:table</span>
<span class="c1">#</span>
<span class="c1"># =============================================================================</span>
<span class="c1">#</span>


<span class="n">SimRingdownID</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="n">next_id</span><span class="o">.</span><span class="n">type</span><span class="p">(</span><span class="sa">u</span><span class="s2">&quot;simulation_id&quot;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">SimRingdownTable</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">Table</span><span class="p">):</span>
	<span class="n">tableName</span> <span class="o">=</span> <span class="s2">&quot;sim_ringdown&quot;</span>
	<span class="n">validcolumns</span> <span class="o">=</span> <span class="p">{</span>
		<span class="s2">&quot;process:process_id&quot;</span><span class="p">:</span> <span class="s2">&quot;int_8s&quot;</span><span class="p">,</span>
		<span class="s2">&quot;waveform&quot;</span><span class="p">:</span> <span class="s2">&quot;lstring&quot;</span><span class="p">,</span>
		<span class="s2">&quot;coordinates&quot;</span><span class="p">:</span> <span class="s2">&quot;lstring&quot;</span><span class="p">,</span>
		<span class="s2">&quot;geocent_start_time&quot;</span><span class="p">:</span> <span class="s2">&quot;int_4s&quot;</span><span class="p">,</span>
		<span class="s2">&quot;geocent_start_time_ns&quot;</span><span class="p">:</span> <span class="s2">&quot;int_4s&quot;</span><span class="p">,</span>
		<span class="s2">&quot;h_start_time&quot;</span><span class="p">:</span> <span class="s2">&quot;int_4s&quot;</span><span class="p">,</span>
		<span class="s2">&quot;h_start_time_ns&quot;</span><span class="p">:</span> <span class="s2">&quot;int_4s&quot;</span><span class="p">,</span>
		<span class="s2">&quot;l_start_time&quot;</span><span class="p">:</span> <span class="s2">&quot;int_4s&quot;</span><span class="p">,</span>
		<span class="s2">&quot;l_start_time_ns&quot;</span><span class="p">:</span> <span class="s2">&quot;int_4s&quot;</span><span class="p">,</span>
		<span class="s2">&quot;v_start_time&quot;</span><span class="p">:</span> <span class="s2">&quot;int_4s&quot;</span><span class="p">,</span>
		<span class="s2">&quot;v_start_time_ns&quot;</span><span class="p">:</span> <span class="s2">&quot;int_4s&quot;</span><span class="p">,</span>
		<span class="s2">&quot;start_time_gmst&quot;</span><span class="p">:</span> <span class="s2">&quot;real_8&quot;</span><span class="p">,</span>
		<span class="s2">&quot;longitude&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;latitude&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;distance&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;inclination&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;polarization&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;frequency&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;quality&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;phase&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;mass&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;spin&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;epsilon&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;amplitude&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;eff_dist_h&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;eff_dist_l&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;eff_dist_v&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;hrss&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;hrss_h&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;hrss_l&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;hrss_v&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;simulation_id&quot;</span><span class="p">:</span> <span class="s2">&quot;int_8s&quot;</span>
	<span class="p">}</span>
	<span class="n">constraints</span> <span class="o">=</span> <span class="s2">&quot;PRIMARY KEY (simulation_id)&quot;</span>
	<span class="n">next_id</span> <span class="o">=</span> <span class="n">SimRingdownID</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">SimRingdown</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">Table</span><span class="o">.</span><span class="n">RowType</span><span class="p">):</span>
	<span class="vm">__slots__</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">Column</span><span class="o">.</span><span class="n">ColumnName</span><span class="p">,</span> <span class="n">SimRingdownTable</span><span class="o">.</span><span class="n">validcolumns</span><span class="p">))</span>

	<span class="n">geocent_start</span> <span class="o">=</span> <span class="n">gpsproperty_with_gmst</span><span class="p">(</span><span class="s2">&quot;geocent_start_time&quot;</span><span class="p">,</span> <span class="s2">&quot;geocent_start_time_ns&quot;</span><span class="p">,</span> <span class="s2">&quot;start_time_gmst&quot;</span><span class="p">)</span>

	<span class="nd">@property</span>
	<span class="k">def</span> <span class="nf">ra_dec</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">longitude</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">latitude</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
			<span class="k">return</span> <span class="kc">None</span>
		<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">longitude</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">latitude</span>

	<span class="nd">@ra_dec</span><span class="o">.</span><span class="n">setter</span>
	<span class="k">def</span> <span class="nf">ra_dec</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">radec</span><span class="p">):</span>
		<span class="k">if</span> <span class="n">radec</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">longitude</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">latitude</span> <span class="o">=</span> <span class="kc">None</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">longitude</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">latitude</span> <span class="o">=</span> <span class="n">radec</span>

	<span class="k">def</span> <span class="nf">time_at_instrument</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">instrument</span><span class="p">,</span> <span class="n">offsetvector</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Return the start time of the injection, delay corrected for</span>
<span class="sd">		the displacement from the geocentre to the given</span>
<span class="sd">		instrument.</span>

<span class="sd">		NOTE:  this method does not account for the rotation of the</span>
<span class="sd">		Earth that occurs during the transit of the plane wave from</span>
<span class="sd">		the detector to the geocentre.  That is, it is assumed the</span>
<span class="sd">		Earth is in the same orientation with respect to the</span>
<span class="sd">		celestial sphere when the wave passes through the detector</span>
<span class="sd">		as when it passes through the geocentre.  The Earth rotates</span>
<span class="sd">		by about 1.5 urad during the 21 ms it takes light to travel</span>
<span class="sd">		the radius of the Earth, which corresponds to 10 m of</span>
<span class="sd">		displacement at the equator, or 33 light-ns.  Therefore,</span>
<span class="sd">		the failure to do a proper retarded time calculation here</span>
<span class="sd">		results in errors as large as 33 ns.  This is insignificant</span>
<span class="sd">		for ring-down searches, but be aware that this</span>
<span class="sd">		approximation is being made if the return value is used in</span>
<span class="sd">		other contexts.</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="c1"># the offset is subtracted from the time of the injection.</span>
		<span class="c1"># injections are done this way so that when the triggers</span>
		<span class="c1"># that result from an injection have the offset vector</span>
		<span class="c1"># added to their times the triggers will form a coinc</span>
		<span class="n">t_geocent</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">geocent_start</span> <span class="o">-</span> <span class="n">offsetvector</span><span class="p">[</span><span class="n">instrument</span><span class="p">]</span>
		<span class="n">ra</span><span class="p">,</span> <span class="n">dec</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ra_dec</span>
		<span class="k">return</span> <span class="n">t_geocent</span> <span class="o">+</span> <span class="n">lal</span><span class="o">.</span><span class="n">TimeDelayFromEarthCenter</span><span class="p">(</span><span class="n">lal</span><span class="o">.</span><span class="n">cached_detector_by_prefix</span><span class="p">[</span><span class="n">instrument</span><span class="p">]</span><span class="o">.</span><span class="n">location</span><span class="p">,</span> <span class="n">ra</span><span class="p">,</span> <span class="n">dec</span><span class="p">,</span> <span class="n">t_geocent</span><span class="p">)</span>


<span class="n">SimRingdownTable</span><span class="o">.</span><span class="n">RowType</span> <span class="o">=</span> <span class="n">SimRingdown</span>


<span class="c1">#</span>
<span class="c1"># =============================================================================</span>
<span class="c1">#</span>
<span class="c1">#                               summ_value:table</span>
<span class="c1">#</span>
<span class="c1"># =============================================================================</span>
<span class="c1">#</span>


<span class="n">SummValueID</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="n">next_id</span><span class="o">.</span><span class="n">type</span><span class="p">(</span><span class="sa">u</span><span class="s2">&quot;summ_value_id&quot;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">SummValueTable</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">Table</span><span class="p">):</span>
	<span class="n">tableName</span> <span class="o">=</span> <span class="s2">&quot;summ_value&quot;</span>
	<span class="n">validcolumns</span> <span class="o">=</span> <span class="p">{</span>
		<span class="s2">&quot;summ_value_id&quot;</span><span class="p">:</span> <span class="s2">&quot;int_8s&quot;</span><span class="p">,</span>
		<span class="s2">&quot;program&quot;</span><span class="p">:</span> <span class="s2">&quot;lstring&quot;</span><span class="p">,</span>
		<span class="s2">&quot;process:process_id&quot;</span><span class="p">:</span> <span class="s2">&quot;int_8s&quot;</span><span class="p">,</span>
		<span class="s2">&quot;frameset_group&quot;</span><span class="p">:</span> <span class="s2">&quot;lstring&quot;</span><span class="p">,</span>
		<span class="s2">&quot;segment_definer:segment_def_id&quot;</span><span class="p">:</span> <span class="s2">&quot;int_8s&quot;</span><span class="p">,</span>
		<span class="s2">&quot;start_time&quot;</span><span class="p">:</span> <span class="s2">&quot;int_4s&quot;</span><span class="p">,</span>
		<span class="s2">&quot;start_time_ns&quot;</span><span class="p">:</span> <span class="s2">&quot;int_4s&quot;</span><span class="p">,</span>
		<span class="s2">&quot;end_time&quot;</span><span class="p">:</span> <span class="s2">&quot;int_4s&quot;</span><span class="p">,</span>
		<span class="s2">&quot;end_time_ns&quot;</span><span class="p">:</span> <span class="s2">&quot;int_4s&quot;</span><span class="p">,</span>
		<span class="s2">&quot;ifo&quot;</span><span class="p">:</span> <span class="s2">&quot;lstring&quot;</span><span class="p">,</span>
		<span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;lstring&quot;</span><span class="p">,</span>
		<span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="s2">&quot;real_4&quot;</span><span class="p">,</span>
		<span class="s2">&quot;intvalue&quot;</span><span class="p">:</span> <span class="s2">&quot;int_4s&quot;</span><span class="p">,</span>
		<span class="s2">&quot;comment&quot;</span><span class="p">:</span> <span class="s2">&quot;lstring&quot;</span>
	<span class="p">}</span>
	<span class="n">constraints</span> <span class="o">=</span> <span class="s2">&quot;PRIMARY KEY (summ_value_id)&quot;</span>
	<span class="n">next_id</span> <span class="o">=</span> <span class="n">SummValueID</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">SummValue</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">Table</span><span class="o">.</span><span class="n">RowType</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">	Example:</span>

<span class="sd">	&gt;&gt;&gt; x = SummValue()</span>
<span class="sd">	&gt;&gt;&gt; x.instruments = (u&quot;H1&quot;, u&quot;L1&quot;)</span>
<span class="sd">	&gt;&gt;&gt; print(x.ifo)</span>
<span class="sd">	H1,L1</span>
<span class="sd">	&gt;&gt;&gt; assert x.instruments == set([u&#39;H1&#39;, u&#39;L1&#39;])</span>
<span class="sd">	&gt;&gt;&gt; x.start = LIGOTimeGPS(0)</span>
<span class="sd">	&gt;&gt;&gt; x.end = LIGOTimeGPS(10)</span>
<span class="sd">	&gt;&gt;&gt; x.segment</span>
<span class="sd">	segment(LIGOTimeGPS(0, 0), LIGOTimeGPS(10, 0))</span>
<span class="sd">	&gt;&gt;&gt; x.segment = None</span>
<span class="sd">	&gt;&gt;&gt; print(x.segment)</span>
<span class="sd">	None</span>
<span class="sd">	&quot;&quot;&quot;</span>
	<span class="vm">__slots__</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">Column</span><span class="o">.</span><span class="n">ColumnName</span><span class="p">,</span> <span class="n">SummValueTable</span><span class="o">.</span><span class="n">validcolumns</span><span class="p">))</span>

	<span class="n">instruments</span> <span class="o">=</span> <span class="n">instrumentsproperty</span><span class="p">(</span><span class="s2">&quot;ifo&quot;</span><span class="p">)</span>

	<span class="n">start</span> <span class="o">=</span> <span class="n">gpsproperty</span><span class="p">(</span><span class="s2">&quot;start_time&quot;</span><span class="p">,</span> <span class="s2">&quot;start_time_ns&quot;</span><span class="p">)</span>
	<span class="n">end</span> <span class="o">=</span> <span class="n">gpsproperty</span><span class="p">(</span><span class="s2">&quot;end_time&quot;</span><span class="p">,</span> <span class="s2">&quot;end_time_ns&quot;</span><span class="p">)</span>
	<span class="n">segment</span> <span class="o">=</span> <span class="n">segmentproperty</span><span class="p">(</span><span class="s2">&quot;start&quot;</span><span class="p">,</span> <span class="s2">&quot;end&quot;</span><span class="p">)</span>


<span class="n">SummValueTable</span><span class="o">.</span><span class="n">RowType</span> <span class="o">=</span> <span class="n">SummValue</span>


<span class="c1">#</span>
<span class="c1"># =============================================================================</span>
<span class="c1">#</span>
<span class="c1">#                                segment:table</span>
<span class="c1">#</span>
<span class="c1"># =============================================================================</span>
<span class="c1">#</span>


<span class="n">SegmentID</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="n">next_id</span><span class="o">.</span><span class="n">type</span><span class="p">(</span><span class="sa">u</span><span class="s2">&quot;segment_id&quot;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">SegmentTable</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">Table</span><span class="p">):</span>
	<span class="n">tableName</span> <span class="o">=</span> <span class="s2">&quot;segment&quot;</span>
	<span class="n">validcolumns</span> <span class="o">=</span> <span class="p">{</span>
		<span class="s2">&quot;creator_db&quot;</span><span class="p">:</span> <span class="s2">&quot;int_4s&quot;</span><span class="p">,</span>
		<span class="s2">&quot;process:process_id&quot;</span><span class="p">:</span> <span class="s2">&quot;int_8s&quot;</span><span class="p">,</span>
		<span class="s2">&quot;segment_id&quot;</span><span class="p">:</span> <span class="s2">&quot;int_8s&quot;</span><span class="p">,</span>
		<span class="s2">&quot;start_time&quot;</span><span class="p">:</span> <span class="s2">&quot;int_4s&quot;</span><span class="p">,</span>
		<span class="s2">&quot;start_time_ns&quot;</span><span class="p">:</span> <span class="s2">&quot;int_4s&quot;</span><span class="p">,</span>
		<span class="s2">&quot;end_time&quot;</span><span class="p">:</span> <span class="s2">&quot;int_4s&quot;</span><span class="p">,</span>
		<span class="s2">&quot;end_time_ns&quot;</span><span class="p">:</span> <span class="s2">&quot;int_4s&quot;</span><span class="p">,</span>
		<span class="s2">&quot;segment_definer:segment_def_id&quot;</span><span class="p">:</span> <span class="s2">&quot;int_8s&quot;</span><span class="p">,</span>
		<span class="s2">&quot;segment_def_cdb&quot;</span><span class="p">:</span> <span class="s2">&quot;int_4s&quot;</span>
	<span class="p">}</span>
	<span class="n">constraints</span> <span class="o">=</span> <span class="s2">&quot;PRIMARY KEY (segment_id)&quot;</span>
	<span class="n">next_id</span> <span class="o">=</span> <span class="n">SegmentID</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>


<span class="nd">@functools</span><span class="o">.</span><span class="n">total_ordering</span>
<span class="k">class</span> <span class="nc">Segment</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">Table</span><span class="o">.</span><span class="n">RowType</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">	Example:</span>

<span class="sd">	&gt;&gt;&gt; x = Segment()</span>
<span class="sd">	&gt;&gt;&gt; x.start = LIGOTimeGPS(0)</span>
<span class="sd">	&gt;&gt;&gt; x.end = LIGOTimeGPS(10)</span>
<span class="sd">	&gt;&gt;&gt; x.segment</span>
<span class="sd">	segment(LIGOTimeGPS(0, 0), LIGOTimeGPS(10, 0))</span>
<span class="sd">	&gt;&gt;&gt; x.segment = None</span>
<span class="sd">	&gt;&gt;&gt; print(x.segment)</span>
<span class="sd">	None</span>
<span class="sd">	&gt;&gt;&gt; print(x.start)</span>
<span class="sd">	None</span>
<span class="sd">	&gt;&gt;&gt; # non-LIGOTimeGPS times are converted to LIGOTimeGPS</span>
<span class="sd">	&gt;&gt;&gt; x.segment = (20, 30.125)</span>
<span class="sd">	&gt;&gt;&gt; x.end</span>
<span class="sd">	LIGOTimeGPS(30, 125000000)</span>
<span class="sd">	&gt;&gt;&gt; # initialization from a tuple or with arguments</span>
<span class="sd">	&gt;&gt;&gt; Segment((20, 30)).segment</span>
<span class="sd">	segment(LIGOTimeGPS(20, 0), LIGOTimeGPS(30, 0))</span>
<span class="sd">	&gt;&gt;&gt; Segment(20, 30).segment</span>
<span class="sd">	segment(LIGOTimeGPS(20, 0), LIGOTimeGPS(30, 0))</span>
<span class="sd">	&gt;&gt;&gt; # use as a segment object in segmentlist operations</span>
<span class="sd">	&gt;&gt;&gt; from ligo import segments</span>
<span class="sd">	&gt;&gt;&gt; x = segments.segmentlist([Segment(0, 10), Segment(20, 30)])</span>
<span class="sd">	&gt;&gt;&gt; abs(x)</span>
<span class="sd">	LIGOTimeGPS(20, 0)</span>
<span class="sd">	&gt;&gt;&gt; y = segments.segmentlist([Segment(5, 15), Segment(25, 35)])</span>
<span class="sd">	&gt;&gt;&gt; abs(x &amp; y)</span>
<span class="sd">	LIGOTimeGPS(10, 0)</span>
<span class="sd">	&gt;&gt;&gt; abs(x | y)</span>
<span class="sd">	LIGOTimeGPS(30, 0)</span>
<span class="sd">	&gt;&gt;&gt; 8.0 in x</span>
<span class="sd">	True</span>
<span class="sd">	&gt;&gt;&gt; 12 in x</span>
<span class="sd">	False</span>
<span class="sd">	&gt;&gt;&gt; Segment(2, 3) in x</span>
<span class="sd">	True</span>
<span class="sd">	&gt;&gt;&gt; Segment(2, 12) in x</span>
<span class="sd">	False</span>
<span class="sd">	&gt;&gt;&gt; segments.segment(2, 3) in x</span>
<span class="sd">	True</span>
<span class="sd">	&gt;&gt;&gt; segments.segment(2, 12) in x</span>
<span class="sd">	False</span>
<span class="sd">	&gt;&gt;&gt; # make sure results are segment table row objects</span>
<span class="sd">	&gt;&gt;&gt; segments.segmentlist(map(Segment, x &amp; y))	# doctest: +ELLIPSIS</span>
<span class="sd">	[&lt;ligo.lw.lsctables.Segment object at 0x...&gt;, &lt;ligo.lw.lsctables.Segment object at 0x...&gt;]</span>

<span class="sd">	Unbounded intervals are permitted.  See gpsproperty for information</span>
<span class="sd">	on the encoding scheme used internally, and its limitations.</span>

<span class="sd">	Example:</span>

<span class="sd">	&gt;&gt;&gt; x = Segment()</span>
<span class="sd">	&gt;&gt;&gt; # OK</span>
<span class="sd">	&gt;&gt;&gt; x.start = -segments.infinity()</span>
<span class="sd">	&gt;&gt;&gt; # also OK</span>
<span class="sd">	&gt;&gt;&gt; x.start = float(&quot;-inf&quot;)</span>
<span class="sd">	&gt;&gt;&gt; # infinite boundaries always returned as segments.infinity</span>
<span class="sd">	&gt;&gt;&gt; # instances</span>
<span class="sd">	&gt;&gt;&gt; x.start</span>
<span class="sd">	-infinity</span>
<span class="sd">	&gt;&gt;&gt; x.end = float(&quot;+inf&quot;)</span>
<span class="sd">	&gt;&gt;&gt; x.segment</span>
<span class="sd">	segment(-infinity, infinity)</span>
<span class="sd">	&quot;&quot;&quot;</span>
	<span class="vm">__slots__</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">Column</span><span class="o">.</span><span class="n">ColumnName</span><span class="p">,</span> <span class="n">SegmentTable</span><span class="o">.</span><span class="n">validcolumns</span><span class="p">))</span>

	<span class="n">start</span> <span class="o">=</span> <span class="n">gpsproperty</span><span class="p">(</span><span class="s2">&quot;start_time&quot;</span><span class="p">,</span> <span class="s2">&quot;start_time_ns&quot;</span><span class="p">)</span>
	<span class="n">end</span> <span class="o">=</span> <span class="n">gpsproperty</span><span class="p">(</span><span class="s2">&quot;end_time&quot;</span><span class="p">,</span> <span class="s2">&quot;end_time_ns&quot;</span><span class="p">)</span>
	<span class="n">segment</span> <span class="o">=</span> <span class="n">segmentproperty</span><span class="p">(</span><span class="s2">&quot;start&quot;</span><span class="p">,</span> <span class="s2">&quot;end&quot;</span><span class="p">)</span>

	<span class="c1"># emulate a ligo.segments.segment object</span>

	<span class="k">def</span> <span class="fm">__abs__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="k">return</span> <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">segment</span><span class="p">)</span>

	<span class="k">def</span> <span class="fm">__lt__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
		<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">segment</span> <span class="o">&lt;</span> <span class="n">other</span>

	<span class="k">def</span> <span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
		<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">segment</span> <span class="o">==</span> <span class="n">other</span>

	<span class="k">def</span> <span class="fm">__contains__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
		<span class="k">return</span> <span class="n">other</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">segment</span>

	<span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">i</span><span class="p">):</span>
		<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">segment</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

	<span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
		<span class="k">if</span> <span class="n">args</span><span class="p">:</span>
			<span class="k">try</span><span class="p">:</span>
				<span class="c1"># first try unpacking arguments</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">segment</span> <span class="o">=</span> <span class="n">args</span>
			<span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
				<span class="c1"># didn&#39;t work, try unpacking 0th argument</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">segment</span><span class="p">,</span> <span class="o">=</span> <span class="n">args</span>
		<span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
			<span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>

	<span class="k">def</span> <span class="fm">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">segment</span><span class="p">)</span>

	<span class="k">def</span> <span class="nf">__nonzero__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="k">return</span> <span class="nb">bool</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">segment</span><span class="p">)</span>


<span class="n">SegmentTable</span><span class="o">.</span><span class="n">RowType</span> <span class="o">=</span> <span class="n">Segment</span>


<span class="c1">#</span>
<span class="c1"># =============================================================================</span>
<span class="c1">#</span>
<span class="c1">#                            segment_definer:table</span>
<span class="c1">#</span>
<span class="c1"># =============================================================================</span>
<span class="c1">#</span>


<span class="n">SegmentDefID</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="n">next_id</span><span class="o">.</span><span class="n">type</span><span class="p">(</span><span class="sa">u</span><span class="s2">&quot;segment_def_id&quot;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">SegmentDefTable</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">Table</span><span class="p">):</span>
	<span class="n">tableName</span> <span class="o">=</span> <span class="s2">&quot;segment_definer&quot;</span>
	<span class="n">validcolumns</span> <span class="o">=</span> <span class="p">{</span>
		<span class="s2">&quot;creator_db&quot;</span><span class="p">:</span> <span class="s2">&quot;int_4s&quot;</span><span class="p">,</span>
		<span class="s2">&quot;process:process_id&quot;</span><span class="p">:</span> <span class="s2">&quot;int_8s&quot;</span><span class="p">,</span>
		<span class="s2">&quot;segment_def_id&quot;</span><span class="p">:</span> <span class="s2">&quot;int_8s&quot;</span><span class="p">,</span>
		<span class="s2">&quot;ifos&quot;</span><span class="p">:</span> <span class="s2">&quot;lstring&quot;</span><span class="p">,</span>
		<span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;lstring&quot;</span><span class="p">,</span>
		<span class="s2">&quot;version&quot;</span><span class="p">:</span> <span class="s2">&quot;int_4s&quot;</span><span class="p">,</span>
		<span class="s2">&quot;comment&quot;</span><span class="p">:</span> <span class="s2">&quot;lstring&quot;</span><span class="p">,</span>
		<span class="s2">&quot;insertion_time&quot;</span><span class="p">:</span> <span class="s2">&quot;int_4s&quot;</span>
	<span class="p">}</span>
	<span class="n">constraints</span> <span class="o">=</span> <span class="s2">&quot;PRIMARY KEY (segment_def_id)&quot;</span>
	<span class="n">next_id</span> <span class="o">=</span> <span class="n">SegmentDefID</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">SegmentDef</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">Table</span><span class="o">.</span><span class="n">RowType</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">	Example:</span>

<span class="sd">	&gt;&gt;&gt; x = SegmentDef()</span>
<span class="sd">	&gt;&gt;&gt; x.instruments = (u&quot;H1&quot;, u&quot;L1&quot;)</span>
<span class="sd">	&gt;&gt;&gt; print(x.ifos)</span>
<span class="sd">	H1,L1</span>
<span class="sd">	&gt;&gt;&gt; assert x.instruments == set([u&#39;H1&#39;, u&#39;L1&#39;])</span>
<span class="sd">	&quot;&quot;&quot;</span>
	<span class="vm">__slots__</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">Column</span><span class="o">.</span><span class="n">ColumnName</span><span class="p">,</span> <span class="n">SegmentDefTable</span><span class="o">.</span><span class="n">validcolumns</span><span class="p">))</span>

	<span class="n">instruments</span> <span class="o">=</span> <span class="n">instrumentsproperty</span><span class="p">(</span><span class="s2">&quot;ifos&quot;</span><span class="p">)</span>


<span class="n">SegmentDefTable</span><span class="o">.</span><span class="n">RowType</span> <span class="o">=</span> <span class="n">SegmentDef</span>


<span class="c1">#</span>
<span class="c1"># =============================================================================</span>
<span class="c1">#</span>
<span class="c1">#                            segment_summary:table</span>
<span class="c1">#</span>
<span class="c1"># =============================================================================</span>
<span class="c1">#</span>


<span class="n">SegmentSumID</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="n">next_id</span><span class="o">.</span><span class="n">type</span><span class="p">(</span><span class="sa">u</span><span class="s2">&quot;segment_sum_id&quot;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">SegmentSumTable</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">Table</span><span class="p">):</span>
	<span class="n">tableName</span> <span class="o">=</span> <span class="s2">&quot;segment_summary&quot;</span>
	<span class="n">validcolumns</span> <span class="o">=</span> <span class="p">{</span>
		<span class="s2">&quot;creator_db&quot;</span><span class="p">:</span> <span class="s2">&quot;int_4s&quot;</span><span class="p">,</span>
		<span class="s2">&quot;process:process_id&quot;</span><span class="p">:</span> <span class="s2">&quot;int_8s&quot;</span><span class="p">,</span>
		<span class="s2">&quot;segment_sum_id&quot;</span><span class="p">:</span> <span class="s2">&quot;int_8s&quot;</span><span class="p">,</span>
		<span class="s2">&quot;start_time&quot;</span><span class="p">:</span> <span class="s2">&quot;int_4s&quot;</span><span class="p">,</span>
		<span class="s2">&quot;start_time_ns&quot;</span><span class="p">:</span> <span class="s2">&quot;int_4s&quot;</span><span class="p">,</span>
		<span class="s2">&quot;end_time&quot;</span><span class="p">:</span> <span class="s2">&quot;int_4s&quot;</span><span class="p">,</span>
		<span class="s2">&quot;end_time_ns&quot;</span><span class="p">:</span> <span class="s2">&quot;int_4s&quot;</span><span class="p">,</span>
		<span class="s2">&quot;comment&quot;</span><span class="p">:</span> <span class="s2">&quot;lstring&quot;</span><span class="p">,</span>
		<span class="s2">&quot;segment_definer:segment_def_id&quot;</span><span class="p">:</span> <span class="s2">&quot;int_8s&quot;</span><span class="p">,</span>
		<span class="s2">&quot;segment_def_cdb&quot;</span><span class="p">:</span> <span class="s2">&quot;int_4s&quot;</span>
	<span class="p">}</span>
	<span class="n">constraints</span> <span class="o">=</span> <span class="s2">&quot;PRIMARY KEY (segment_sum_id)&quot;</span>
	<span class="n">next_id</span> <span class="o">=</span> <span class="n">SegmentSumID</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

	<span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">segment_def_id</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Return a segmentlist object describing the times spanned by</span>
<span class="sd">		the segments carrying the given segment_def_id.  If</span>
<span class="sd">		segment_def_id is None then all segments are returned.</span>

<span class="sd">		Note:  the result is not coalesced, the segmentlist</span>
<span class="sd">		contains the segments as they appear in the table.</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="k">if</span> <span class="n">segment_def_id</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
			<span class="k">return</span> <span class="n">segments</span><span class="o">.</span><span class="n">segmentlist</span><span class="p">(</span><span class="n">row</span><span class="o">.</span><span class="n">segment</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">segments</span><span class="o">.</span><span class="n">segmentlist</span><span class="p">(</span><span class="n">row</span><span class="o">.</span><span class="n">segment</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="bp">self</span> <span class="k">if</span> <span class="n">row</span><span class="o">.</span><span class="n">segment_def_id</span> <span class="o">==</span> <span class="n">segment_def_id</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">SegmentSum</span><span class="p">(</span><span class="n">Segment</span><span class="p">):</span>
	<span class="vm">__slots__</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">Column</span><span class="o">.</span><span class="n">ColumnName</span><span class="p">,</span> <span class="n">SegmentSumTable</span><span class="o">.</span><span class="n">validcolumns</span><span class="p">))</span>

	<span class="n">start</span> <span class="o">=</span> <span class="n">gpsproperty</span><span class="p">(</span><span class="s2">&quot;start_time&quot;</span><span class="p">,</span> <span class="s2">&quot;start_time_ns&quot;</span><span class="p">)</span>
	<span class="n">end</span> <span class="o">=</span> <span class="n">gpsproperty</span><span class="p">(</span><span class="s2">&quot;end_time&quot;</span><span class="p">,</span> <span class="s2">&quot;end_time_ns&quot;</span><span class="p">)</span>
	<span class="n">segment</span> <span class="o">=</span> <span class="n">segmentproperty</span><span class="p">(</span><span class="s2">&quot;start&quot;</span><span class="p">,</span> <span class="s2">&quot;end&quot;</span><span class="p">)</span>


<span class="n">SegmentSumTable</span><span class="o">.</span><span class="n">RowType</span> <span class="o">=</span> <span class="n">SegmentSum</span>


<span class="c1">#</span>
<span class="c1"># =============================================================================</span>
<span class="c1">#</span>
<span class="c1">#                               time_slide:table</span>
<span class="c1">#</span>
<span class="c1"># =============================================================================</span>
<span class="c1">#</span>


<span class="n">TimeSlideID</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="n">next_id</span><span class="o">.</span><span class="n">type</span><span class="p">(</span><span class="sa">u</span><span class="s2">&quot;time_slide_id&quot;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">TimeSlideTable</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">Table</span><span class="p">):</span>
	<span class="n">tableName</span> <span class="o">=</span> <span class="s2">&quot;time_slide&quot;</span>
	<span class="n">validcolumns</span> <span class="o">=</span> <span class="p">{</span>
		<span class="s2">&quot;process:process_id&quot;</span><span class="p">:</span> <span class="s2">&quot;int_8s&quot;</span><span class="p">,</span>
		<span class="s2">&quot;time_slide_id&quot;</span><span class="p">:</span> <span class="s2">&quot;int_8s&quot;</span><span class="p">,</span>
		<span class="s2">&quot;instrument&quot;</span><span class="p">:</span> <span class="s2">&quot;lstring&quot;</span><span class="p">,</span>
		<span class="s2">&quot;offset&quot;</span><span class="p">:</span> <span class="s2">&quot;real_8&quot;</span>
	<span class="p">}</span>
	<span class="n">constraints</span> <span class="o">=</span> <span class="s2">&quot;PRIMARY KEY (time_slide_id, instrument)&quot;</span>
	<span class="n">next_id</span> <span class="o">=</span> <span class="n">TimeSlideID</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

	<span class="k">def</span> <span class="nf">as_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Return a dictionary mapping time slide IDs to offset</span>
<span class="sd">		dictionaries.</span>

<span class="sd">		NOTE:  very little checking is done, e.g., for repeated</span>
<span class="sd">		instruments for a given ID (which could suggest an ID</span>
<span class="sd">		collision).</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="c1"># import is done here to reduce risk of a cyclic</span>
		<span class="c1"># dependency.  at the time of writing there is not one, but</span>
		<span class="c1"># we can help prevent it in the future by putting this</span>
		<span class="c1"># here.</span>
		<span class="kn">from</span> <span class="nn">lalburst.offsetvector</span> <span class="kn">import</span> <span class="n">offsetvector</span>
		<span class="k">return</span> <span class="nb">dict</span><span class="p">((</span><span class="n">time_slide_id</span><span class="p">,</span> <span class="n">offsetvector</span><span class="p">((</span><span class="n">row</span><span class="o">.</span><span class="n">instrument</span><span class="p">,</span> <span class="n">row</span><span class="o">.</span><span class="n">offset</span><span class="p">)</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">rows</span><span class="p">))</span> <span class="k">for</span> <span class="n">time_slide_id</span><span class="p">,</span> <span class="n">rows</span> <span class="ow">in</span> <span class="n">itertools</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">row</span><span class="p">:</span> <span class="n">row</span><span class="o">.</span><span class="n">time_slide_id</span><span class="p">),</span> <span class="k">lambda</span> <span class="n">row</span><span class="p">:</span> <span class="n">row</span><span class="o">.</span><span class="n">time_slide_id</span><span class="p">))</span>

	<span class="k">def</span> <span class="nf">append_offsetvector</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">offsetvect</span><span class="p">,</span> <span class="n">process</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Append rows describing an instrument --&gt; offset mapping to</span>
<span class="sd">		this table.  offsetvect is a dictionary mapping instrument</span>
<span class="sd">		to offset.  process should be the row in the process table</span>
<span class="sd">		on which the new time_slide table rows will be blamed (or</span>
<span class="sd">		any object with a process_id attribute).  The return value</span>
<span class="sd">		is the time_slide_id assigned to the new rows.</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="n">time_slide_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_next_id</span><span class="p">()</span>
		<span class="k">for</span> <span class="n">instrument</span><span class="p">,</span> <span class="n">offset</span> <span class="ow">in</span> <span class="n">offsetvect</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">RowType</span><span class="p">(</span>
				<span class="n">process_id</span> <span class="o">=</span> <span class="n">process</span><span class="o">.</span><span class="n">process_id</span><span class="p">,</span>
				<span class="n">time_slide_id</span> <span class="o">=</span> <span class="n">time_slide_id</span><span class="p">,</span>
				<span class="n">instrument</span> <span class="o">=</span> <span class="n">instrument</span><span class="p">,</span>
				<span class="n">offset</span> <span class="o">=</span> <span class="n">offset</span>
			<span class="p">))</span>
		<span class="k">return</span> <span class="n">time_slide_id</span>

	<span class="k">def</span> <span class="nf">get_time_slide_id</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">offsetdict</span><span class="p">,</span> <span class="n">create_new</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">superset_ok</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">nonunique_ok</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Return the time_slide_id corresponding to the offset vector</span>
<span class="sd">		described by offsetdict, a dictionary of instrument/offset</span>
<span class="sd">		pairs.</span>

<span class="sd">		If the optional create_new argument is None (the default),</span>
<span class="sd">		then the table must contain a matching offset vector.  The</span>
<span class="sd">		return value is the ID of that vector.  If the table does</span>
<span class="sd">		not contain a matching offset vector then KeyError is</span>
<span class="sd">		raised.</span>

<span class="sd">		If the optional create_new argument is set to a Process</span>
<span class="sd">		object (or any other object with a process_id attribute),</span>
<span class="sd">		then if the table does not contain a matching offset vector</span>
<span class="sd">		a new one will be added to the table and marked as having</span>
<span class="sd">		been created by the given process.  The return value is the</span>
<span class="sd">		ID of the (possibly newly created) matching offset vector.</span>

<span class="sd">		If the optional superset_ok argument is False (the default)</span>
<span class="sd">		then an offset vector in the table is considered to &quot;match&quot;</span>
<span class="sd">		the requested offset vector only if they contain the exact</span>
<span class="sd">		same set of instruments.  If the superset_ok argument is</span>
<span class="sd">		True, then an offset vector in the table is considered to</span>
<span class="sd">		match the requested offset vector as long as it provides</span>
<span class="sd">		the same offsets for the same instruments as the requested</span>
<span class="sd">		vector, even if it provides offsets for other instruments</span>
<span class="sd">		as well.</span>

<span class="sd">		More than one offset vector in the table might match the</span>
<span class="sd">		requested vector.  If the optional nonunique_ok argument is</span>
<span class="sd">		False (the default), then KeyError will be raised if more</span>
<span class="sd">		than one offset vector in the table is found to match the</span>
<span class="sd">		requested vector.  If the optional nonunique_ok is True</span>
<span class="sd">		then the return value is the ID of one of the matching</span>
<span class="sd">		offset vectors selected at random.</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="c1"># look for matching offset vectors</span>
		<span class="k">if</span> <span class="n">superset_ok</span><span class="p">:</span>
			<span class="n">ids</span> <span class="o">=</span> <span class="p">[</span><span class="n">time_slide_id</span> <span class="k">for</span> <span class="n">time_slide_id</span><span class="p">,</span> <span class="n">slide</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">as_dict</span><span class="p">()</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">offsetdict</span> <span class="o">==</span> <span class="nb">dict</span><span class="p">((</span><span class="n">instrument</span><span class="p">,</span> <span class="n">offset</span><span class="p">)</span> <span class="k">for</span> <span class="n">instrument</span><span class="p">,</span> <span class="n">offset</span> <span class="ow">in</span> <span class="n">slide</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">instrument</span> <span class="ow">in</span> <span class="n">offsetdict</span><span class="p">)]</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="n">ids</span> <span class="o">=</span> <span class="p">[</span><span class="n">time_slide_id</span> <span class="k">for</span> <span class="n">time_slide_id</span><span class="p">,</span> <span class="n">slide</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">as_dict</span><span class="p">()</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">offsetdict</span> <span class="o">==</span> <span class="n">slide</span><span class="p">]</span>
		<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ids</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
			<span class="c1"># found more than one</span>
			<span class="k">if</span> <span class="n">nonunique_ok</span><span class="p">:</span>
				<span class="c1"># and that&#39;s OK</span>
				<span class="k">return</span> <span class="n">ids</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
			<span class="c1"># and that&#39;s not OK</span>
			<span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> not unique&quot;</span> <span class="o">%</span> <span class="nb">repr</span><span class="p">(</span><span class="n">offsetdict</span><span class="p">))</span>
		<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ids</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
			<span class="c1"># found one</span>
			<span class="k">return</span> <span class="n">ids</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
		<span class="c1"># offset vector not found in table</span>
		<span class="k">if</span> <span class="n">create_new</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
			<span class="c1"># and that&#39;s not OK</span>
			<span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> not found&quot;</span> <span class="o">%</span> <span class="nb">repr</span><span class="p">(</span><span class="n">offsetdict</span><span class="p">))</span>
		<span class="c1"># that&#39;s OK, create new vector, return its ID</span>
		<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">append_offsetvector</span><span class="p">(</span><span class="n">offsetdict</span><span class="p">,</span> <span class="n">create_new</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">TimeSlide</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">Table</span><span class="o">.</span><span class="n">RowType</span><span class="p">):</span>
	<span class="vm">__slots__</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">Column</span><span class="o">.</span><span class="n">ColumnName</span><span class="p">,</span> <span class="n">TimeSlideTable</span><span class="o">.</span><span class="n">validcolumns</span><span class="p">))</span>


<span class="n">TimeSlideTable</span><span class="o">.</span><span class="n">RowType</span> <span class="o">=</span> <span class="n">TimeSlide</span>


<span class="c1">#</span>
<span class="c1"># =============================================================================</span>
<span class="c1">#</span>
<span class="c1">#                             coinc_definer:table</span>
<span class="c1">#</span>
<span class="c1"># =============================================================================</span>
<span class="c1">#</span>


<span class="n">CoincDefID</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="n">next_id</span><span class="o">.</span><span class="n">type</span><span class="p">(</span><span class="sa">u</span><span class="s2">&quot;coinc_def_id&quot;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">CoincDefTable</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">Table</span><span class="p">):</span>
	<span class="n">tableName</span> <span class="o">=</span> <span class="s2">&quot;coinc_definer&quot;</span>
	<span class="n">validcolumns</span> <span class="o">=</span> <span class="p">{</span>
		<span class="s2">&quot;coinc_def_id&quot;</span><span class="p">:</span> <span class="s2">&quot;int_8s&quot;</span><span class="p">,</span>
		<span class="s2">&quot;search&quot;</span><span class="p">:</span> <span class="s2">&quot;lstring&quot;</span><span class="p">,</span>
		<span class="s2">&quot;search_coinc_type&quot;</span><span class="p">:</span> <span class="s2">&quot;int_4u&quot;</span><span class="p">,</span>
		<span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;lstring&quot;</span>
	<span class="p">}</span>
	<span class="n">constraints</span> <span class="o">=</span> <span class="s2">&quot;PRIMARY KEY (coinc_def_id)&quot;</span>
	<span class="n">next_id</span> <span class="o">=</span> <span class="n">CoincDefID</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
	<span class="n">how_to_index</span> <span class="o">=</span> <span class="p">{</span>
		<span class="s2">&quot;cd_ssct_index&quot;</span><span class="p">:</span> <span class="p">(</span><span class="s2">&quot;search&quot;</span><span class="p">,</span> <span class="s2">&quot;search_coinc_type&quot;</span><span class="p">)</span>
	<span class="p">}</span>

	<span class="k">def</span> <span class="nf">get_coinc_def_id</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">search</span><span class="p">,</span> <span class="n">search_coinc_type</span><span class="p">,</span> <span class="n">create_new</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">description</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Return the coinc_def_id for the row in the table whose</span>
<span class="sd">		search string and search_coinc_type integer have the values</span>
<span class="sd">		given.  If a matching row is not found, the default</span>
<span class="sd">		behaviour is to create a new row and return the ID assigned</span>
<span class="sd">		to the new row.  If, instead, create_new is False then</span>
<span class="sd">		KeyError is raised when a matching row is not found.  The</span>
<span class="sd">		optional description parameter can be used to set the</span>
<span class="sd">		description string assigned to the new row if one is</span>
<span class="sd">		created, otherwise the new row is left with no description.</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="c1"># look for the ID</span>
		<span class="n">rows</span> <span class="o">=</span> <span class="p">[</span><span class="n">row</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="bp">self</span> <span class="k">if</span> <span class="p">(</span><span class="n">row</span><span class="o">.</span><span class="n">search</span><span class="p">,</span> <span class="n">row</span><span class="o">.</span><span class="n">search_coinc_type</span><span class="p">)</span> <span class="o">==</span> <span class="p">(</span><span class="n">search</span><span class="p">,</span> <span class="n">search_coinc_type</span><span class="p">)]</span>
		<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">rows</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
			<span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;(search, search coincidence type) = (&#39;</span><span class="si">%s</span><span class="s2">&#39;, </span><span class="si">%d</span><span class="s2">) is not unique&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">search</span><span class="p">,</span> <span class="n">search_coinc_type</span><span class="p">))</span>
		<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">rows</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
			<span class="k">return</span> <span class="n">rows</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">coinc_def_id</span>

		<span class="c1"># coinc type not found in table</span>
		<span class="k">if</span> <span class="ow">not</span> <span class="n">create_new</span><span class="p">:</span>
			<span class="k">raise</span> <span class="ne">KeyError</span><span class="p">((</span><span class="n">search</span><span class="p">,</span> <span class="n">search_coinc_type</span><span class="p">))</span>
		<span class="n">coinc_def_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_next_id</span><span class="p">()</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">RowType</span><span class="p">(</span>
			<span class="n">coinc_def_id</span> <span class="o">=</span> <span class="n">coinc_def_id</span><span class="p">,</span>
			<span class="n">search</span> <span class="o">=</span> <span class="n">search</span><span class="p">,</span>
			<span class="n">search_coinc_type</span> <span class="o">=</span> <span class="n">search_coinc_type</span><span class="p">,</span>
			<span class="n">description</span> <span class="o">=</span> <span class="n">description</span>
		<span class="p">))</span>

		<span class="c1"># return new ID</span>
		<span class="k">return</span> <span class="n">coinc_def_id</span>


<span class="k">class</span> <span class="nc">CoincDef</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">Table</span><span class="o">.</span><span class="n">RowType</span><span class="p">):</span>
	<span class="vm">__slots__</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">Column</span><span class="o">.</span><span class="n">ColumnName</span><span class="p">,</span> <span class="n">CoincDefTable</span><span class="o">.</span><span class="n">validcolumns</span><span class="p">))</span>


<span class="n">CoincDefTable</span><span class="o">.</span><span class="n">RowType</span> <span class="o">=</span> <span class="n">CoincDef</span>


<span class="c1">#</span>
<span class="c1"># =============================================================================</span>
<span class="c1">#</span>
<span class="c1">#                              coinc_event:table</span>
<span class="c1">#</span>
<span class="c1"># =============================================================================</span>
<span class="c1">#</span>


<span class="n">CoincID</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="n">next_id</span><span class="o">.</span><span class="n">type</span><span class="p">(</span><span class="sa">u</span><span class="s2">&quot;coinc_event_id&quot;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">CoincTable</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">Table</span><span class="p">):</span>
	<span class="n">tableName</span> <span class="o">=</span> <span class="s2">&quot;coinc_event&quot;</span>
	<span class="n">validcolumns</span> <span class="o">=</span> <span class="p">{</span>
		<span class="s2">&quot;process:process_id&quot;</span><span class="p">:</span> <span class="s2">&quot;int_8s&quot;</span><span class="p">,</span>
		<span class="s2">&quot;coinc_definer:coinc_def_id&quot;</span><span class="p">:</span> <span class="s2">&quot;int_8s&quot;</span><span class="p">,</span>
		<span class="s2">&quot;coinc_event_id&quot;</span><span class="p">:</span> <span class="s2">&quot;int_8s&quot;</span><span class="p">,</span>
		<span class="s2">&quot;time_slide:time_slide_id&quot;</span><span class="p">:</span> <span class="s2">&quot;int_8s&quot;</span><span class="p">,</span>
		<span class="s2">&quot;instruments&quot;</span><span class="p">:</span> <span class="s2">&quot;lstring&quot;</span><span class="p">,</span>
		<span class="s2">&quot;nevents&quot;</span><span class="p">:</span> <span class="s2">&quot;int_4u&quot;</span><span class="p">,</span>
		<span class="s2">&quot;likelihood&quot;</span><span class="p">:</span> <span class="s2">&quot;real_8&quot;</span>
	<span class="p">}</span>
	<span class="n">constraints</span> <span class="o">=</span> <span class="s2">&quot;PRIMARY KEY (coinc_event_id)&quot;</span>
	<span class="n">next_id</span> <span class="o">=</span> <span class="n">CoincID</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
	<span class="n">how_to_index</span> <span class="o">=</span> <span class="p">{</span>
		<span class="s2">&quot;ce_cdi_index&quot;</span><span class="p">:</span> <span class="p">(</span><span class="s2">&quot;coinc_def_id&quot;</span><span class="p">,),</span>
		<span class="s2">&quot;ce_tsi_index&quot;</span><span class="p">:</span> <span class="p">(</span><span class="s2">&quot;time_slide_id&quot;</span><span class="p">,)</span>
	<span class="p">}</span>


<span class="k">class</span> <span class="nc">Coinc</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">Table</span><span class="o">.</span><span class="n">RowType</span><span class="p">):</span>
	<span class="vm">__slots__</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">Column</span><span class="o">.</span><span class="n">ColumnName</span><span class="p">,</span> <span class="n">CoincTable</span><span class="o">.</span><span class="n">validcolumns</span><span class="p">))</span>

	<span class="n">insts</span> <span class="o">=</span> <span class="n">instrumentsproperty</span><span class="p">(</span><span class="s2">&quot;instruments&quot;</span><span class="p">)</span>


<span class="n">CoincTable</span><span class="o">.</span><span class="n">RowType</span> <span class="o">=</span> <span class="n">Coinc</span>


<span class="c1">#</span>
<span class="c1"># =============================================================================</span>
<span class="c1">#</span>
<span class="c1">#                            coinc_event_map:table</span>
<span class="c1">#</span>
<span class="c1"># =============================================================================</span>
<span class="c1">#</span>


<span class="k">class</span> <span class="nc">CoincMapTable</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">Table</span><span class="p">):</span>
	<span class="n">tableName</span> <span class="o">=</span> <span class="s2">&quot;coinc_event_map&quot;</span>
	<span class="n">validcolumns</span> <span class="o">=</span> <span class="p">{</span>
		<span class="s2">&quot;coinc_event:coinc_event_id&quot;</span><span class="p">:</span> <span class="s2">&quot;int_8s&quot;</span><span class="p">,</span>
		<span class="s2">&quot;table_name&quot;</span><span class="p">:</span> <span class="s2">&quot;char_v&quot;</span><span class="p">,</span>
		<span class="s2">&quot;event_id&quot;</span><span class="p">:</span> <span class="s2">&quot;int_8s&quot;</span>
	<span class="p">}</span>
	<span class="n">how_to_index</span> <span class="o">=</span> <span class="p">{</span>
		<span class="s2">&quot;cem_tn_ei_index&quot;</span><span class="p">:</span> <span class="p">(</span><span class="s2">&quot;table_name&quot;</span><span class="p">,</span> <span class="s2">&quot;event_id&quot;</span><span class="p">),</span>
		<span class="s2">&quot;cem_cei_index&quot;</span><span class="p">:</span> <span class="p">(</span><span class="s2">&quot;coinc_event_id&quot;</span><span class="p">,)</span>
	<span class="p">}</span>

	<span class="k">def</span> <span class="nf">applyKeyMapping</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mapping</span><span class="p">):</span>
		<span class="n">table_column</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getColumnByName</span><span class="p">(</span><span class="s2">&quot;table_name&quot;</span><span class="p">)</span>
		<span class="n">event_id_column</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getColumnByName</span><span class="p">(</span><span class="s2">&quot;event_id&quot;</span><span class="p">)</span>
		<span class="n">coinc_event_id_column</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getColumnByName</span><span class="p">(</span><span class="s2">&quot;coinc_event_id&quot;</span><span class="p">)</span>
		<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">table_name</span><span class="p">,</span> <span class="n">old_event_id</span><span class="p">,</span> <span class="n">old_coinc_event_id</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">table_column</span><span class="p">,</span> <span class="n">event_id_column</span><span class="p">,</span> <span class="n">coinc_event_id_column</span><span class="p">)):</span>
			<span class="k">try</span><span class="p">:</span>
				<span class="n">event_id_column</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">mapping</span><span class="p">[</span><span class="n">table_name</span><span class="p">,</span> <span class="n">old_event_id</span><span class="p">]</span>
			<span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
				<span class="k">pass</span>
			<span class="k">try</span><span class="p">:</span>
				<span class="n">coinc_event_id_column</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">mapping</span><span class="p">[</span><span class="s2">&quot;coinc_event&quot;</span><span class="p">,</span> <span class="n">old_coinc_event_id</span><span class="p">]</span>
			<span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
				<span class="k">pass</span>


<span class="k">class</span> <span class="nc">CoincMap</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">Table</span><span class="o">.</span><span class="n">RowType</span><span class="p">):</span>
	<span class="vm">__slots__</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">Column</span><span class="o">.</span><span class="n">ColumnName</span><span class="p">,</span> <span class="n">CoincMapTable</span><span class="o">.</span><span class="n">validcolumns</span><span class="p">))</span>


<span class="n">CoincMapTable</span><span class="o">.</span><span class="n">RowType</span> <span class="o">=</span> <span class="n">CoincMap</span>


<span class="c1">#</span>
<span class="c1"># =============================================================================</span>
<span class="c1">#</span>
<span class="c1">#                                dq_list Table</span>
<span class="c1">#</span>
<span class="c1"># =============================================================================</span>
<span class="c1">#</span>


<span class="n">DQSpecListID</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="n">next_id</span><span class="o">.</span><span class="n">type</span><span class="p">(</span><span class="sa">u</span><span class="s2">&quot;dq_list_id&quot;</span><span class="p">)</span>
<span class="n">DQSpecListRowID</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="n">next_id</span><span class="o">.</span><span class="n">type</span><span class="p">(</span><span class="sa">u</span><span class="s2">&quot;dq_list_row_id&quot;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">DQSpecListTable</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">Table</span><span class="p">):</span>
	<span class="n">tableName</span> <span class="o">=</span> <span class="s2">&quot;dq_list&quot;</span>
	<span class="n">validcolumns</span> <span class="o">=</span> <span class="p">{</span>
		<span class="s2">&quot;dq_list:dq_list_id&quot;</span><span class="p">:</span> <span class="s2">&quot;int_8s&quot;</span><span class="p">,</span>
		<span class="s2">&quot;dq_list_row_id&quot;</span><span class="p">:</span> <span class="s2">&quot;int_8s&quot;</span><span class="p">,</span>
		<span class="s2">&quot;instrument&quot;</span><span class="p">:</span> <span class="s2">&quot;lstring&quot;</span><span class="p">,</span>
		<span class="s2">&quot;flag&quot;</span><span class="p">:</span> <span class="s2">&quot;lstring&quot;</span><span class="p">,</span>
		<span class="s2">&quot;low_window&quot;</span><span class="p">:</span> <span class="s2">&quot;real_8&quot;</span><span class="p">,</span>
		<span class="s2">&quot;high_window&quot;</span><span class="p">:</span> <span class="s2">&quot;real_8&quot;</span>
	<span class="p">}</span>
	<span class="n">constraints</span> <span class="o">=</span> <span class="s2">&quot;PRIMARY KEY (dq_list_id, dq_list_row_id)&quot;</span>
	<span class="n">next_id</span> <span class="o">=</span> <span class="n">DQSpecListID</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">DQSpec</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">Table</span><span class="o">.</span><span class="n">RowType</span><span class="p">):</span>
	<span class="vm">__slots__</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">Column</span><span class="o">.</span><span class="n">ColumnName</span><span class="p">,</span> <span class="n">DQSpecListTable</span><span class="o">.</span><span class="n">validcolumns</span><span class="p">))</span>

	<span class="k">def</span> <span class="nf">apply_to_segmentlist</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">seglist</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Apply our low and high windows to the segments in a</span>
<span class="sd">		segmentlist.</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">seg</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">seglist</span><span class="p">):</span>
			<span class="n">seglist</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">seg</span><span class="o">.</span><span class="vm">__class__</span><span class="p">(</span><span class="n">seg</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">low_window</span><span class="p">,</span> <span class="n">seg</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">high_window</span><span class="p">)</span>


<span class="n">DQSpecListTable</span><span class="o">.</span><span class="n">RowType</span> <span class="o">=</span> <span class="n">DQSpec</span>


<span class="c1">#</span>
<span class="c1"># =============================================================================</span>
<span class="c1">#</span>
<span class="c1">#                            veto_definer:table</span>
<span class="c1">#</span>
<span class="c1"># =============================================================================</span>
<span class="c1">#</span>


<span class="k">class</span> <span class="nc">VetoDefTable</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">Table</span><span class="p">):</span>
	<span class="n">tableName</span> <span class="o">=</span> <span class="s2">&quot;veto_definer&quot;</span>
	<span class="n">validcolumns</span> <span class="o">=</span> <span class="p">{</span>
		<span class="s2">&quot;process:process_id&quot;</span><span class="p">:</span> <span class="s2">&quot;int_8s&quot;</span><span class="p">,</span>
		<span class="s2">&quot;ifo&quot;</span><span class="p">:</span> <span class="s2">&quot;lstring&quot;</span><span class="p">,</span>
		<span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;lstring&quot;</span><span class="p">,</span>
		<span class="s2">&quot;version&quot;</span><span class="p">:</span> <span class="s2">&quot;int_4s&quot;</span><span class="p">,</span>
		<span class="s2">&quot;category&quot;</span><span class="p">:</span> <span class="s2">&quot;int_4s&quot;</span><span class="p">,</span>
		<span class="s2">&quot;start_time&quot;</span><span class="p">:</span> <span class="s2">&quot;int_4s&quot;</span><span class="p">,</span>
		<span class="s2">&quot;end_time&quot;</span><span class="p">:</span> <span class="s2">&quot;int_4s&quot;</span><span class="p">,</span>
		<span class="s2">&quot;start_pad&quot;</span><span class="p">:</span> <span class="s2">&quot;int_4s&quot;</span><span class="p">,</span>
		<span class="s2">&quot;end_pad&quot;</span><span class="p">:</span> <span class="s2">&quot;int_4s&quot;</span><span class="p">,</span>
		<span class="s2">&quot;comment&quot;</span><span class="p">:</span> <span class="s2">&quot;lstring&quot;</span>
	<span class="p">}</span>

	<span class="k">def</span> <span class="nf">versions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">category</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Report the versions available for the (name, category)</span>
<span class="sd">		pair.</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="k">return</span> <span class="nb">set</span><span class="p">(</span><span class="n">row</span><span class="o">.</span><span class="n">version</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="bp">self</span> <span class="k">if</span> <span class="n">row</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="n">name</span> <span class="ow">and</span> <span class="n">row</span><span class="o">.</span><span class="n">category</span> <span class="o">==</span> <span class="n">category</span><span class="p">)</span>

	<span class="k">def</span> <span class="nf">segmentlistdict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">category</span><span class="p">,</span> <span class="n">version</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">padded</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Return a segments.segmentlistdict mapping instrument to the</span>
<span class="sd">		segments for the (name, category) pair.  If version is None</span>
<span class="sd">		(the default) then the newest version of the segments are</span>
<span class="sd">		reported, otherwise the segments for the requested version</span>
<span class="sd">		are reported.  If padded is boolean False (the default) the</span>
<span class="sd">		non-padded segments are reported, otherwise the padded</span>
<span class="sd">		segments are reported.</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="n">seglists</span> <span class="o">=</span> <span class="n">segments</span><span class="o">.</span><span class="n">segmentlistdict</span><span class="p">()</span>
		<span class="k">if</span> <span class="n">version</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
			<span class="c1"># not an error if there are no versions, just means</span>
			<span class="c1"># the segmentlists are empty</span>
			<span class="n">version</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">versions</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">category</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="kc">None</span><span class="p">,))</span>
		<span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
			<span class="k">if</span> <span class="n">row</span><span class="o">.</span><span class="n">name</span> <span class="o">!=</span> <span class="n">name</span> <span class="ow">or</span> <span class="n">row</span><span class="o">.</span><span class="n">category</span> <span class="o">!=</span> <span class="n">category</span> <span class="ow">or</span> <span class="n">row</span><span class="o">.</span><span class="n">version</span> <span class="o">!=</span> <span class="n">version</span><span class="p">:</span>
				<span class="k">continue</span>
			<span class="k">try</span><span class="p">:</span>
				<span class="n">seglist</span> <span class="o">=</span> <span class="n">seglists</span><span class="p">[</span><span class="n">row</span><span class="o">.</span><span class="n">ifo</span><span class="p">]</span>
			<span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
				<span class="n">seglist</span> <span class="o">=</span> <span class="n">seglists</span><span class="p">[</span><span class="n">row</span><span class="o">.</span><span class="n">ifo</span><span class="p">]</span> <span class="o">=</span> <span class="n">segments</span><span class="o">.</span><span class="n">segmentlist</span><span class="p">()</span>
			<span class="n">seglist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">row</span><span class="o">.</span><span class="n">segment_padded</span> <span class="k">if</span> <span class="n">padded</span> <span class="k">else</span> <span class="n">row</span><span class="o">.</span><span class="n">segment</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">seglists</span>


<span class="k">class</span> <span class="nc">VetoDef</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">Table</span><span class="o">.</span><span class="n">RowType</span><span class="p">):</span>
	<span class="vm">__slots__</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">Column</span><span class="o">.</span><span class="n">ColumnName</span><span class="p">,</span> <span class="n">VetoDefTable</span><span class="o">.</span><span class="n">validcolumns</span><span class="p">))</span>

	<span class="c1"># because detchar refuses to allow vetoes to have non-integer</span>
	<span class="c1"># boundaries, even in principle (i.e., by designing out the choice</span>
	<span class="c1"># altogether, regardless current use), we have a problem</span>
	<span class="c1"># interfacing to this table using standard tools.  to work-around</span>
	<span class="c1"># the problem virtual nanoseconds columns are emulated, which</span>
	<span class="c1"># always truncate towards 0.</span>

	<span class="nd">@property</span>
	<span class="k">def</span> <span class="nf">start_time_ns</span><span class="p">(</span><span class="n">eslf</span><span class="p">):</span>
		<span class="k">return</span> <span class="mi">0</span>
	<span class="nd">@start_time_ns</span><span class="o">.</span><span class="n">setter</span>
	<span class="k">def</span> <span class="nf">start_time_ns</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
		<span class="k">pass</span>

	<span class="nd">@property</span>
	<span class="k">def</span> <span class="nf">end_time_ns</span><span class="p">(</span><span class="n">eslf</span><span class="p">):</span>
		<span class="k">return</span> <span class="mi">0</span>
	<span class="nd">@end_time_ns</span><span class="o">.</span><span class="n">setter</span>
	<span class="k">def</span> <span class="nf">end_time_ns</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
		<span class="k">pass</span>

	<span class="c1"># now we can provide easier interfaces to the start and stop pair</span>

	<span class="n">start</span> <span class="o">=</span> <span class="n">gpsproperty</span><span class="p">(</span><span class="s2">&quot;start_time&quot;</span><span class="p">,</span> <span class="s2">&quot;start_time_ns&quot;</span><span class="p">)</span>
	<span class="n">end</span> <span class="o">=</span> <span class="n">gpsproperty</span><span class="p">(</span><span class="s2">&quot;end_time&quot;</span><span class="p">,</span> <span class="s2">&quot;end_time_ns&quot;</span><span class="p">)</span>
	<span class="n">segment</span> <span class="o">=</span> <span class="n">gpsproperty</span><span class="p">(</span><span class="s2">&quot;start&quot;</span><span class="p">,</span> <span class="s2">&quot;end&quot;</span><span class="p">)</span>

	<span class="nd">@property</span>
	<span class="k">def</span> <span class="nf">start_padded</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">start</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_pad</span>
	<span class="nd">@property</span>
	<span class="k">def</span> <span class="nf">end_padded</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">end</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">end_pad</span>

	<span class="n">segment_padded</span> <span class="o">=</span> <span class="n">gpsproperty</span><span class="p">(</span><span class="s2">&quot;start_padded&quot;</span><span class="p">,</span> <span class="s2">&quot;end_padded&quot;</span><span class="p">)</span>


<span class="n">VetoDefTable</span><span class="o">.</span><span class="n">RowType</span> <span class="o">=</span> <span class="n">VetoDef</span>


<span class="c1">#</span>
<span class="c1"># =============================================================================</span>
<span class="c1">#</span>
<span class="c1">#                                Table Metadata</span>
<span class="c1">#</span>
<span class="c1"># =============================================================================</span>
<span class="c1">#</span>


<span class="c1">#</span>
<span class="c1"># Table name ---&gt; table type mapping.</span>
<span class="c1">#</span>


<span class="n">TableByName</span> <span class="o">=</span> <span class="p">{</span>
	<span class="n">CoincDefTable</span><span class="o">.</span><span class="n">tableName</span><span class="p">:</span> <span class="n">CoincDefTable</span><span class="p">,</span>
	<span class="n">CoincInspiralTable</span><span class="o">.</span><span class="n">tableName</span><span class="p">:</span> <span class="n">CoincInspiralTable</span><span class="p">,</span>
	<span class="n">CoincMapTable</span><span class="o">.</span><span class="n">tableName</span><span class="p">:</span> <span class="n">CoincMapTable</span><span class="p">,</span>
	<span class="n">CoincRingdownTable</span><span class="o">.</span><span class="n">tableName</span><span class="p">:</span> <span class="n">CoincRingdownTable</span><span class="p">,</span>
	<span class="n">CoincTable</span><span class="o">.</span><span class="n">tableName</span><span class="p">:</span> <span class="n">CoincTable</span><span class="p">,</span>
	<span class="n">DQSpecListTable</span><span class="o">.</span><span class="n">tableName</span><span class="p">:</span> <span class="n">DQSpecListTable</span><span class="p">,</span>
	<span class="n">ProcessParamsTable</span><span class="o">.</span><span class="n">tableName</span><span class="p">:</span> <span class="n">ProcessParamsTable</span><span class="p">,</span>
	<span class="n">ProcessTable</span><span class="o">.</span><span class="n">tableName</span><span class="p">:</span> <span class="n">ProcessTable</span><span class="p">,</span>
	<span class="n">SearchSummaryTable</span><span class="o">.</span><span class="n">tableName</span><span class="p">:</span> <span class="n">SearchSummaryTable</span><span class="p">,</span>
	<span class="n">SearchSummVarsTable</span><span class="o">.</span><span class="n">tableName</span><span class="p">:</span> <span class="n">SearchSummVarsTable</span><span class="p">,</span>
	<span class="n">SegmentDefTable</span><span class="o">.</span><span class="n">tableName</span><span class="p">:</span> <span class="n">SegmentDefTable</span><span class="p">,</span>
	<span class="n">SegmentSumTable</span><span class="o">.</span><span class="n">tableName</span><span class="p">:</span> <span class="n">SegmentSumTable</span><span class="p">,</span>
	<span class="n">SegmentTable</span><span class="o">.</span><span class="n">tableName</span><span class="p">:</span> <span class="n">SegmentTable</span><span class="p">,</span>
	<span class="n">SimBurstTable</span><span class="o">.</span><span class="n">tableName</span><span class="p">:</span> <span class="n">SimBurstTable</span><span class="p">,</span>
	<span class="n">SimInspiralTable</span><span class="o">.</span><span class="n">tableName</span><span class="p">:</span> <span class="n">SimInspiralTable</span><span class="p">,</span>
	<span class="n">SimRingdownTable</span><span class="o">.</span><span class="n">tableName</span><span class="p">:</span> <span class="n">SimRingdownTable</span><span class="p">,</span>
	<span class="n">SnglBurstTable</span><span class="o">.</span><span class="n">tableName</span><span class="p">:</span> <span class="n">SnglBurstTable</span><span class="p">,</span>
	<span class="n">SnglInspiralTable</span><span class="o">.</span><span class="n">tableName</span><span class="p">:</span> <span class="n">SnglInspiralTable</span><span class="p">,</span>
	<span class="n">SnglRingdownTable</span><span class="o">.</span><span class="n">tableName</span><span class="p">:</span> <span class="n">SnglRingdownTable</span><span class="p">,</span>
	<span class="n">SummValueTable</span><span class="o">.</span><span class="n">tableName</span><span class="p">:</span> <span class="n">SummValueTable</span><span class="p">,</span>
	<span class="n">TimeSlideTable</span><span class="o">.</span><span class="n">tableName</span><span class="p">:</span> <span class="n">TimeSlideTable</span><span class="p">,</span>
	<span class="n">VetoDefTable</span><span class="o">.</span><span class="n">tableName</span><span class="p">:</span> <span class="n">VetoDefTable</span>
<span class="p">}</span>


<span class="k">def</span> <span class="nf">reset_next_ids</span><span class="p">(</span><span class="n">classes</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">	For each class in the list, if the .next_id attribute is not None</span>
<span class="sd">	(meaning the table has an ID generator associated with it), set</span>
<span class="sd">	.next_id to 0.  This has the effect of reseting the ID generators,</span>
<span class="sd">	and is useful in applications that process multiple documents and</span>
<span class="sd">	add new rows to tables in those documents.  Calling this function</span>
<span class="sd">	between documents prevents new row IDs from growing continuously</span>
<span class="sd">	from document to document.  There is no need to do this, it&#39;s</span>
<span class="sd">	purpose is merely aesthetic, but it can be confusing to open a</span>
<span class="sd">	document and find process ID 300 in the process table and wonder</span>
<span class="sd">	what happened to the other 299 processes.</span>

<span class="sd">	Example:</span>

<span class="sd">	&gt;&gt;&gt; reset_next_ids(TableByName.values())</span>
<span class="sd">	&quot;&quot;&quot;</span>
	<span class="k">for</span> <span class="bp">cls</span> <span class="ow">in</span> <span class="n">classes</span><span class="p">:</span>
		<span class="bp">cls</span><span class="o">.</span><span class="n">reset_next_id</span><span class="p">()</span>


<span class="c1">#</span>
<span class="c1"># =============================================================================</span>
<span class="c1">#</span>
<span class="c1">#                               Content Handler</span>
<span class="c1">#</span>
<span class="c1"># =============================================================================</span>
<span class="c1">#</span>


<span class="c1">#</span>
<span class="c1"># Override portions of a ligolw.LIGOLWContentHandler class</span>
<span class="c1">#</span>


<span class="k">def</span> <span class="nf">use_in</span><span class="p">(</span><span class="n">ContentHandler</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">	Modify ContentHandler, a sub-class of</span>
<span class="sd">	ligo.lw.ligolw.LIGOLWContentHandler, to cause it to use the Table</span>
<span class="sd">	classes defined in this module when parsing XML documents.</span>

<span class="sd">	Example:</span>

<span class="sd">	&gt;&gt;&gt; from ligo.lw import ligolw</span>
<span class="sd">	&gt;&gt;&gt; class MyContentHandler(ligolw.LIGOLWContentHandler):</span>
<span class="sd">	...	pass</span>
<span class="sd">	...</span>
<span class="sd">	&gt;&gt;&gt; use_in(MyContentHandler)</span>
<span class="sd">	&lt;class &#39;ligo.lw.lsctables.MyContentHandler&#39;&gt;</span>
<span class="sd">	&quot;&quot;&quot;</span>
	<span class="n">ContentHandler</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="n">use_in</span><span class="p">(</span><span class="n">ContentHandler</span><span class="p">)</span>

	<span class="k">def</span> <span class="nf">startTable</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">attrs</span><span class="p">,</span> <span class="n">__orig_startTable</span> <span class="o">=</span> <span class="n">ContentHandler</span><span class="o">.</span><span class="n">startTable</span><span class="p">):</span>
		<span class="n">name</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="n">Table</span><span class="o">.</span><span class="n">TableName</span><span class="p">(</span><span class="n">attrs</span><span class="p">[</span><span class="sa">u</span><span class="s2">&quot;Name&quot;</span><span class="p">])</span>
		<span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">TableByName</span><span class="p">:</span>
			<span class="k">return</span> <span class="n">TableByName</span><span class="p">[</span><span class="n">name</span><span class="p">](</span><span class="n">attrs</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">__orig_startTable</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">attrs</span><span class="p">)</span>

	<span class="n">ContentHandler</span><span class="o">.</span><span class="n">startTable</span> <span class="o">=</span> <span class="n">startTable</span>

	<span class="k">return</span> <span class="n">ContentHandler</span>
</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2015, 2016, 2017, Alexander Nitz, Ian Harry, Christopher M. Biwer, Duncan A.  Brown, Josh Willis, and Tito Dal Canton.
      <span class="lastupdated">Last updated on Dec 06, 2021.
      </span></p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>